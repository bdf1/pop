var plugins_bb40132b_638b_4a9f_b028_d3fe47acc8d1={init:function(){console.log("插件编写测试");this._afterLoadResources=function(){};this.sol=function(d,e,b,c){var a=core.getFlag("mp");core.status.hero.flags.grp[d][e]=b;c[b]++;if(a[d-1][e]==a[d][e]&&!core.status.hero.flags.grp[d-1][e]){core.sol(d-1,e,b,c)}if(a[d+1][e]==a[d][e]&&!core.status.hero.flags.grp[d+1][e]){core.sol(d+1,e,b,c)}if(a[d][e-1]==a[d][e]&&!core.status.hero.flags.grp[d][e-1]){core.sol(d,e-1,b,c)}if(a[d][e+1]==a[d][e]&&!core.status.hero.flags.grp[d][e+1]){core.sol(d,e+1,b,c)}};this.fs=function(){core.setFlag("grp",[[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0]]);core.setFlag("_",0);var c=core.getFlag("mp"),d=0,e=[0];for(var a=1;a<=10;a++){for(var b=1;b<=10;b++){if(c[a][b]&&!core.getFlag("grp")[a][b]&&!(c[a][b]!=c[a][b-1]&&c[a][b]!=c[a][b+1]&&c[a][b]!=c[a-1][b]&&c[a][b]!=c[a+1][b])){e.push(0),core.sol(a,b,++d,e)}}}core.setFlag("v",e);return d};this.drop=function(){var d=[0,0,0,0,0,0,0,0,0,0,0,0];for(var a=1;a<=10;a++){d=[0,0,0,0,0,0,0,0,0,0,0,0];for(var b=1,c=0;b<=10;b++){if(core.status.hero.flags.mp[a][b]){d[++c]=core.status.hero.flags.mp[a][b]}}core.status.hero.flags.mp[a]=d}};this.left=function(){var c=[[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0]];for(var a=1,b=0;a<=10;a++){if(core.status.hero.flags.mp[a][1]){c[++b]=core.status.hero.flags.mp[a]}}core.setFlag("mp",c)}},drawLight:function(){this.drawLight=function(e,a,d,c){var b=core.getContextByName(e);if(b==null){if(typeof e=="string"){b=core.createCanvas(e,0,0,core.__PIXELS__,core.__PIXELS__,98)}else{return}}b.mozImageSmoothingEnabled=false;b.webkitImageSmoothingEnabled=false;b.msImageSmoothingEnabled=false;b.imageSmoothingEnabled=false;core.clearMap(e);if(a==null){a=0.9}b.fillStyle="rgba(0,0,0,"+a+")";b.fillRect(0,0,b.canvas.width,b.canvas.height);c=core.clamp(c,0,1);b.globalCompositeOperation="destination-out";d.forEach(function(h){var j=h[0],k=h[1],i=h[2];var f=parseInt(i*c);var g=b.createRadialGradient(j,k,f,j,k,i);g.addColorStop(0,"rgba(0,0,0,1)");g.addColorStop(1,"rgba(0,0,0,0)");b.beginPath();b.fillStyle=g;b.arc(j,k,i,0,2*Math.PI);b.fill()});b.globalCompositeOperation="source-over"}},itemShop:function(){var i=null;var l=0;var h=0;var g=0;var f=0;var k=0;var j=0;var d=[];var c=core.ui._buildFont(20,false),e=core.ui._buildFont(18,false);this.drawItemShop=function(){core.ui._createUIEvent();core.clearMap("uievent");core.ui._uievent_drawSelector({code:1});core.ui._uievent_drawSelector({code:2});core.setTextAlign("uievent","left");core.setTextBaseline("uievent","top");core.fillRect("uievent",0,0,416,416,"black");core.ui._uievent_drawBackground({background:"winskin.png",x:0,y:0,width:416,height:56});core.ui._uievent_drawBackground({background:"winskin.png",x:0,y:56,width:312,height:56});core.ui._uievent_drawBackground({background:"winskin.png",x:0,y:112,width:312,height:304});core.ui._uievent_drawBackground({background:"winskin.png",x:312,y:56,width:104,height:56});core.ui._uievent_drawBackground({background:"winskin.png",x:312,y:112,width:104,height:304});core.setFillStyle("uievent","white");core.setStrokeStyle("uievent","white");core.fillText("uievent","购买",32,74,"white",c);core.fillText("uievent","卖出",132,74);core.fillText("uievent","离开",232,74);core.fillText("uievent","当前金币",324,66,null,e);core.setTextAlign("uievent","right");core.fillText("uievent",core.formatBigNumber(core.status.hero.money),405,89);core.setTextAlign("uievent","left");core.ui._uievent_drawSelector({type:"drawSelector",image:"winskin.png",code:2,x:22+100*l,y:66,width:60,height:33});if(h!=null){core.setTextAlign("uievent","center");core.fillText("uievent",l==0?"买入个数":"卖出个数",364,320,null,c);core.fillText("uievent","?   "+g+"   ?",364,350);core.fillText("uievent","确定",364,380)}var m=core.status.shops[i].choices;d=m.filter(function(z){if(z.condition!=null){try{if(!core.calValue(z.condition)){return false}}catch(y){}}return(l==0&&z.money!=null)||(l==1&&z.sell!=null)});var v=6;k=Math.ceil(d.length/v);f=Math.floor((h||0)/v)+1;if(k>1){var r=156;core.setTextAlign("uievent","center");core.fillText("uievent",f+" / "+k,r,388,null,e);if(f>1){core.fillText("uievent","上一页",r-80,388)}if(f<k){core.fillText("uievent","下一页",r+80,388)}}core.setTextAlign("uievent","left");var w=(f-1)*v;for(var t=0;t<v;++t){var o=w+t;if(o>=d.length){break}var u=d[o];core.drawIcon("uievent",u.id,10,125+t*40);core.setTextAlign("uievent","left");core.fillText("uievent",core.material.items[u.id].name,50,132+t*40,null,c);core.setTextAlign("uievent","right");core.fillText("uievent",(l==0?core.calValue(u.money):core.calValue(u.sell))+"金币/个",300,133+t*40,null,e);core.setTextAlign("uievent","left");if(o==h){var x=core.material.items[u.id].text||"该道具暂无描述";try{x=core.replaceText(x)}catch(p){}for(var q=20;q>=8;q-=2){var n={left:10,fontSize:q,maxWidth:403,lineHeight:1.4};var s=core.getTextContentHeight(x,n);if(s<=50){n.top=(56-s)/2;core.drawTextContent("uievent",x,n);break}}core.ui._uievent_drawSelector({type:"drawSelector",image:"winskin.png",code:1,x:8,y:120+t*40,width:295,height:40});if(l==0&&u.number!=null){core.fillText("uievent","存货",324,132,null,c);core.setTextAlign("uievent","right");core.fillText("uievent",u.number,406,132,null,null,40)}else{if(l==1){core.fillText("uievent","数量",324,132,null,c);core.setTextAlign("uievent","right");core.fillText("uievent",core.itemCount(u.id),406,132,null,null,40)}}core.setTextAlign("uievent","left");core.fillText("uievent","预计金额",324,250);core.setTextAlign("uievent","right");j=g*(l==0?core.calValue(u.money):core.calValue(u.sell));core.fillText("uievent",core.formatBigNumber(j),405,280);core.setTextAlign("uievent","left");core.fillText("uievent",l==0?"已购次数":"已卖次数",324,170);core.setTextAlign("uievent","right");core.fillText("uievent",(l==0?u.money_count:u.sell_count)||0,405,200)}}core.setTextAlign("uievent","left");core.setTextBaseline("uievent","alphabetic")};var a=function(n,m){if(n==null){return}g=core.clamp(g+m,0,Math.min(l==0?Math.floor(core.status.hero.money/core.calValue(n.money)):core.itemCount(n.id),l==0&&n.number!=null?n.number:Number.MAX_SAFE_INTEGER))};var b=function(m){if(m==null||g==0){return}if(l==0){core.status.hero.money-=j;core.getItem(m.id,g);if(m.number!=null){m.number-=g}m.money_count=(m.money_count||0)+g}else{core.status.hero.money+=j;core.removeItem(m.id,g);core.drawTip("成功卖出"+g+"个"+core.material.items[m.id].name,m.id);if(m.number!=null){m.number+=g}m.sell_count=(m.sell_count||0)+g}g=0};this._performItemShopKeyBoard=function(n){var m=d[h]||null;switch(n){case 38:if(h==null){break}if(h==0){h=null}else{h--}g=0;break;case 37:if(h==null){if(l>0){l--}break}a(m,-1);break;case 39:if(h==null){if(l<2){l++}break}a(m,1);break;case 40:if(h==null){if(d.length>0){h=0}break}if(d.length==0){break}h=Math.min(h+1,d.length-1);g=0;break;case 13:case 32:if(h==null){if(l==2){core.insertAction({type:"break"})}else{if(d.length>0){h=0}}break}b(m);break;case 27:if(h==null){core.insertAction({type:"break"});break}h=null;break}};this._performItemShopClick=function(p,q){var n=d[h]||null;if(p>=22&&p<=82&&q>=71&&q<=102){if(l!=0){l=0;h=null;g=0}return}if(p>=122&&p<=182&&q>=71&&q<=102){if(l!=1){l=1;h=null;g=0}return}if(p>=222&&p<=282&&q>=71&&q<=102){return core.insertAction({type:"break"})}if(p>=318&&p<=341&&q>=348&&q<=376){return a(n,-1)}if(p>=388&&p<=416&&q>=348&&q<=376){return a(n,1)}if(p>=341&&p<=387&&q>=380&&q<=407){return b(n)}if(p>=45&&p<=105&&q>=388){if(f>1){h-=6}return}if(p>=208&&p<=268&&q>=388){if(f<k){h=Math.min(h+6,d.length-1)}return}if(p>=9&&p<=300&&q>=120&&q<360){if(d.length==0){return}var m=parseInt((q-120)/40);var o=6*(f-1)+m;if(o>=d.length){o=d.length-1}if(o!=h){h=o;g=0}return}};this.performItemShopAction=function(){if(flags.type==0){return this._performItemShopKeyBoard(flags.keycode)}else{return this._performItemShopClick(flags.px,flags.py)}};this.openItemShop=function(m){i=m;l=0;f=0;h=null;g=0;core.insertAction([{type:"while",condition:"true",data:[{type:"function","function":"function () { core.drawItemShop(); }"},{type:"wait"},{type:"function","function":"function() { core.performItemShopAction(); }"}]},{type:"function","function":'function () { core.deleteCanvas(\'uievent\'); core.ui._uievent_drawSelector({ "code": 1 }); core.ui._uievent_drawSelector({ "code": 2 }); }'}])};core.control.saveData=function(){var m=this.controldata.saveData();for(var n in core.status.shops){if(core.status.shops[n].item){m.shops[n].choices=core.status.shops[n].choices.map(function(o){return{number:o.number,money_count:o.money_count||0,sell_count:o.sell_count||0}})}}return m};core.control.loadData=function(n,m){this.controldata.loadData(n,m);for(var p in n.shops){if(n.shops[p].choices){for(var o=0;o<n.shops[p].choices.length;++o){core.status.shops[p].choices[o].number=n.shops[p].choices[o].number;core.status.shops[p].choices[o].money_count=n.shops[p].choices[o].money_count;core.status.shops[p].choices[o].sell_count=n.shops[p].choices[o].sell_count}}}}},smoothCamera:function(){this.__enableSmoothCamera=false;if(!this.__enableSmoothCamera){return}this.Camera=function(){this.__switchName="smoothCamera";this._cameraNeedRefresh=true;this._nowOffsetX=0;this._nowOffsetY=0;this._targetOffsetX=0;this._targetOffsetY=0;this._currentFloorId=null;this.resetCamera=function(){this._targetOffsetX=core.bigmap.offsetX;this._targetOffsetY=core.bigmap.offsetY;this._nowOffsetX=this._targetOffsetX;this._nowOffsetY=this._targetOffsetY;this._cameraNeedRefresh=true};this.setTarget=function(a,b){this._targetOffsetX=a;this._targetOffsetY=b};this.requestCameraUpdate=function(){this._cameraNeedRefresh=true};this.updateTargetPosition=function(){this._targetOffsetX=core.bigmap.offsetX;this._targetOffsetY=core.bigmap.offsetY};this.updateRefreshFlag=function(){if(this._nowOffsetX!=this._targetOffsetX||this._nowOffsetY!=this._targetOffsetY){this._cameraNeedRefresh=true}};this.canDirectMove=function(){return !core.getFlag(this.__switchName,true)};this.updateCameraPosition=function(){if(this._cameraNeedRefresh){this._cameraNeedRefresh=false;var a=this._targetOffsetX-this._nowOffsetX;var b=this._targetOffsetY-this._nowOffsetY;if(Math.abs(a)<=2&&Math.abs(b)<=2||this.canDirectMove()){this._nowOffsetX=this._targetOffsetX;this._nowOffsetY=this._targetOffsetY}else{this._nowOffsetX+=a/10;this._nowOffsetY+=b/10}var c=-Math.floor(this._nowOffsetX);var d=-Math.floor(this._nowOffsetY);core.bigmap.canvas.forEach(function(e){core.control.setGameCanvasTranslate(e,c,d)});core.relocateCanvas("route",core.status.automaticRoute.offsetX+c,core.status.automaticRoute.offsetY+d);core.setGameCanvasTranslate("hero",c+this._targetOffsetX,d+this._targetOffsetY)}};this.update=function(){this.updateTargetPosition();this.updateRefreshFlag();this.updateCameraPosition()}};control.drawHero=function(g,d){if(!core.isPlaying()||!core.status.floorId||core.status.gameOver){return}var i=core.getHeroLoc("x"),j=core.getHeroLoc("y"),a=core.getHeroLoc("direction");g=g||"stop";d=d||0;var h=core.utils.scan[a];var b=h.x,c=h.y,e=b*d,f=c*d;core.bigmap.offsetX=core.clamp((i-core.__HALF_SIZE__)*32+e,0,32*core.bigmap.width-core.__PIXELS__);core.bigmap.offsetY=core.clamp((j-core.__HALF_SIZE__)*32+f,0,32*core.bigmap.height-core.__PIXELS__);core.clearAutomaticRouteNode(i+b,j+c);core.clearMap("hero");if(!core.hasFlag("hideHero")){this._drawHero_getDrawObjs(a,i,j,g,d).forEach(function(k){core.drawImage("hero",k.img,k.heroIcon[k.status]*k.width,k.heroIcon.loc*k.height,k.width,k.height,k.posx+(32-k.width)/2,k.posy+32-k.height,k.width,k.height)})}core.control.updateViewport()};core.drawHero=function(b,a){return core.control.drawHero(b,a)};this.camera=new this.Camera();this.updateCameraEx=function(){this.camera.update()};control.updateViewport=function(){core.plugin.camera.requestCameraUpdate()};events.prototype.changingFloor=function(a,c,b){this.eventdata.changingFloor(a,c,b);core.plugin.camera.resetCamera()};core.registerAnimationFrame("smoothCameraFlash",true,this.updateCameraEx.bind(this))},rewrite:function(){core.statusBar.image.save.onclick=function(){if(core.status.event.id=="save"){core.events.recoverEvents(core.status.event.interval)}else{return;if(core.status.event.data.current.type!="wait"){return}core.insertAction([{type:"callSave"},{type:"wait"}]);core.doAction()}};core.statusBar.image.load.onclick=function(){if(core.status.event.id=="load"){core.events.recoverEvents(core.status.event.interval)}else{if(core.status.event.data.current.type!="wait"){return}core.insertAction([{type:"callLoad"},{type:"wait"}]);core.doAction()}};core.statusBar.image.settings.onclick=function(){if(core.status.event.data.current.type!="wait"){return}core.insertAction([{type:"confirm",text:"返回标题界面？",yes:[{type:"restart"}],no:[]},{type:"wait"}]);core.doAction()}}};