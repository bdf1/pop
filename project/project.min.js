var data_a1e2fb4a_e986_4524_b0da_9b7ba7c0874d={main:{floorIds:["MT0","time","step"],images:["bg.jpg","winskin.png"],tilesets:["magictower.png"],animates:["hand","sword","zone"],bgms:[],sounds:["broken.mp3","click.mp3","fire.mp3","gameover.mp3","select.mp3","stageclear.mp3","win.mp3"],nameMap:{"背景图.jpg":"bg.jpg","背景音乐.mp3":"bgm.mp3"},startBackground:"bg.jpg",startLogoStyle:"color: black",levelChoose:[["简单","Easy"],["普通","Normal"],["困难","Hard"],["噩梦","Hell"]],equipName:["武器","盾牌"],startBgm:"",statusLeftBackground:"url(project/images/ground.png) repeat",statusTopBackground:"url(project/images/ground.png) repeat",toolsBackground:"url(project/images/ground.png) repeat",borderColor:"#CCCCCC",statusBarColor:"white",hardLabelColor:"red",floorChangingBackground:"black",floorChangingTextColor:"white",font:"Verdana",startButtonsStyle:"background-color: #32369F; opacity: 0.85; color: #FFFFFF; border: #FFFFFF 2px solid; caret-color: #FFD700;"},firstData:{title:"消灭星星",name:"popstar",version:"Ver 2.6.5",floorId:"MT0",hero:{name:"阳光",lv:1,hpmax:0,hp:0,manamax:-1,mana:0,atk:0,def:0,mdef:0,money:0,experience:0,equipment:[],items:{keys:{yellowKey:0,blueKey:0,redKey:0},constants:{},tools:{},equips:{}},loc:{direction:"up",x:12,y:0},flags:{},steps:0},startCanvas:[{type:"comment",text:"在这里可以用事件来自定义绘制标题界面的背景图等"},{type:"comment",text:"也可以直接切换到其他楼层（比如某个开始剧情楼层）进行操作。"},{type:"showImage",code:1,image:"bg.jpg",loc:[0,0],dw:100,dh:100,opacity:1,time:0},{type:"while",condition:"1",data:[{type:"comment",text:"给用户提供选择项，这里简单的使用了choices事件"},{type:"comment",text:"也可以贴按钮图然后使用等待操作来完成"},{type:"choices",choices:[{text:"开始游戏",action:[{type:"comment",text:"检查bgm状态，下同"},{type:"function","function":"function(){\ncore.control.checkBgm()\n}"},{type:"if",condition:"core.flags.startDirectly","true":[{type:"comment",text:"直接开始游戏，设置初始化数据"},{type:"function","function":"function(){\ncore.events.setInitData('')\n}"}],"false":[{type:"comment",text:"动态生成难度选择项"},{type:"function","function":'function(){\nvar choices = [];\nmain.levelChoose.forEach(function (one) {\n\tchoices.push({"text": one[0], "action": [\n\t\t{"type": "function", "function": "function() { core.status.hard = \'"+one[1]+"\'; core.events.setInitData(\'"+one[1]+"\'); }"}\n\t]});\n})\ncore.insertAction({"type": "choices", "choices": choices});\n}'}]},{type:"hideImage",code:1,time:0},{type:"comment",text:"成功选择难度"},{type:"break"}]},{text:"读取存档",action:[{type:"function","function":"function(){\ncore.control.checkBgm()\n}"},{type:"comment",text:"简单的使用“呼出读档界面”来处理"},{type:"callLoad"}]},{text:"回放录像",action:[{type:"function","function":"function(){\ncore.control.checkBgm()\n}"},{type:"comment",text:"这段代码会弹框选择录像文件"},{type:"if",condition:"!core.isReplaying()","true":[{type:"function","function":"function(){\ncore.chooseReplayFile()\n}"}],"false":[]}]}]}]},{type:"comment",text:"接下来会执行startText中的事件"}],startText:[{type:"function","function":"function(){\ncore.T=0\n}"},"规则同普通消除星星。每次消除方块后会自动保存。不允许手动保存。限时模式不会自动保存，需要一次性玩到结束。","每次可以选择一个至少有两个方块的同色的四连通块，消除后可得四连通块包含方块数平方的5倍的分数。消除后上面的方块会掉下来。如果有空列则右边的列会自动向左。","红心后面显示当前分数，金币后面显示当前所选连通块的大小，经验后面显示消除当前所选连通块可得的分数。",{type:"hideHero"},{type:"choices",text:"选择模式",choices:[{text:"经典",action:["每一关都有一个目标分数。你需要消除方块来增加分数。如果没有方块可消除并且剩余方块数<10则可以得到(2000-20×(剩余方块数的平方))分的奖励分数。如果最终分数达到目标分数则进入下一关否则game over。"]},{text:"30秒",action:[{type:"setValue",name:"status:mdef",value:"30000"},"你需要在30秒时间内通过消除方块获得尽量多的分数。方块会自动填补。十字架后显示剩余时间，单位毫秒。",{type:"changeFloor",floorId:"time",time:0}]},{text:"60秒",action:[{type:"setValue",name:"status:mdef",value:"60000"},"你需要在60秒时间内通过消除方块获得尽量多的分数。方块会自动填补。十字架后显示剩余时间，单位毫秒。",{type:"changeFloor",floorId:"time",time:0}]},{text:"30步",action:[{type:"setValue",name:"status:mdef",value:"30"},"你需要在30步内通过消除方块获得尽量多的分数。方块会自动填补。十字架后显示剩余步数。",{type:"changeFloor",floorId:"step",time:0}]},{text:"60步",action:[{type:"setValue",name:"status:mdef",value:"60"},"你需要在60步内通过消除方块获得尽量多的分数。方块会自动填补。十字架后显示剩余步数。",{type:"changeFloor",floorId:"step",time:0}]}]}],shops:[],levelUp:[{need:"0",title:"",action:[]}]},values:{lavaDamage:0,poisonDamage:0,weakValue:0,redJewel:0,blueJewel:0,greenJewel:0,redPotion:0,bluePotion:0,yellowPotion:0,greenPotion:0,breakArmor:0,counterAttack:0,purify:0,hatred:0,moveSpeed:100,animateSpeed:400,floorChangeTime:0},flags:{enableFloor:true,enableName:false,enableLv:false,enableHPMax:false,enableMana:false,enableMDef:true,enableMoney:true,enableExperience:true,enableLevelUp:false,levelUpLeftMode:false,enableKeys:false,enablePZF:false,enableDebuff:false,enableSkill:false,flyNearStair:false,flyRecordPosition:false,pickaxeFourDirections:false,bombFourDirections:false,snowFourDirections:false,bigKeyIsBox:false,steelDoorWithoutKey:false,itemFirstText:false,equipment:false,equipboxButton:false,iconInEquipbox:false,enableAddPoint:false,enableNegativeDamage:false,hatredDecrease:true,betweenAttackCeil:false,betweenAttackMax:false,useLoop:false,startUsingCanvas:false,startDirectly:true,statusCanvas:false,statusCanvasRowsOnMobile:3,displayEnemyDamage:true,displayCritical:true,displayExtraDamage:true,enableGentleClick:true,potionWhileRouting:false,ignoreChangeFloor:true,canGoDeadZone:false,enableMoveDirectly:true,enableDisabledShop:true,disableShopOnDamage:false,blurFg:false,checkConsole:true}};var enemys_fcae963b_31c9_42b4_b48c_bb48d09f3f80={greenSlime:{name:"绿头怪",hp:100,atk:120,def:0,money:1,experience:1,point:0,special:[1,5,7,8]},redSlime:{name:"红头怪",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:[16,18],value:10},blackSlime:{name:"青头怪",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},slimelord:{name:"怪王",hp:100,atk:120,def:0,money:10,experience:0,point:0,special:[1,9]},bat:{name:"小蝙蝠",hp:100,atk:120,def:0,money:2,experience:0,point:0,special:1},bigBat:{name:"大蝙蝠",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},redBat:{name:"红蝙蝠",hp:100,atk:120,def:0,money:5,experience:0,point:0,special:4},vampire:{name:"冥灵魔王",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},skeleton:{name:"骷髅人",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},skeletonSoilder:{name:"骷髅士兵",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},skeletonCaptain:{name:"骷髅队长",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},ghostSkeleton:{name:"冥队长",hp:100,atk:120,def:0,money:8,experience:0,point:0,special:7},zombie:{name:"兽人",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},zombieKnight:{name:"兽人武士",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},rock:{name:"石头人",hp:100,atk:120,def:0,money:4,experience:0,point:0,special:3},slimeMan:{name:"影子战士",hp:100,atk:0,def:0,money:11,experience:0,point:0,special:[10,21],atkValue:2,defValue:3},bluePriest:{name:"初级法师",hp:100,atk:120,def:0,money:3,experience:0,point:1,special:2},redPriest:{name:"高级法师",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},brownWizard:{name:"初级巫师",hp:100,atk:120,def:0,money:16,experience:0,point:0,special:15,value:100,range:2},redWizard:{name:"高级巫师",hp:1000,atk:1200,def:0,money:160,experience:0,point:0,special:15,value:200,zoneSquare:true},yellowGuard:{name:"初级卫兵",hp:100,atk:120,def:0,money:10,experience:0,point:0,special:0},blueGuard:{name:"中级卫兵",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},redGuard:{name:"高级卫兵",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},swordsman:{name:"双手剑士",hp:100,atk:120,def:0,money:6,experience:0,point:0,special:[5,23]},soldier:{name:"冥战士",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},yellowKnight:{name:"金骑士",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},redKnight:{name:"红骑士",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},darkKnight:{name:"黑骑士",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},blackKing:{name:"黑衣魔王",hp:1000,atk:500,def:0,money:1000,experience:1000,point:0,special:0,notBomb:true},yellowKing:{name:"黄衣魔王",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},greenKing:{name:"青衣武士",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},blueKnight:{name:"蓝骑士",hp:100,atk:120,def:0,money:9,experience:0,point:0,special:8},goldSlime:{name:"黄头怪",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},poisonSkeleton:{name:"紫骷髅",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},poisonBat:{name:"紫蝙蝠",hp:100,atk:120,def:0,money:14,experience:0,point:0,special:13},steelRock:{name:"铁面人",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},skeletonPriest:{name:"骷髅法师",hp:100,atk:100,def:0,money:0,experience:0,point:0,special:18,value:20},skeletonKing:{name:"骷髅王",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},skeletonWizard:{name:"骷髅巫师",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},redSkeletonCaption:{name:"骷髅武士",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},badHero:{name:"迷失勇者",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},demon:{name:"魔神武士",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},demonPriest:{name:"魔神法师",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},goldHornSlime:{name:"金角怪",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},redKing:{name:"红衣魔王",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},whiteKing:{name:"白衣武士",hp:100,atk:120,def:0,money:17,experience:0,point:0,special:16},blackMagician:{name:"黑暗大法师",hp:100,atk:120,def:0,money:12,experience:0,point:0,special:11,value:0.3333333333333333,add:true,notBomb:true},silverSlime:{name:"银头怪",hp:100,atk:120,def:0,money:15,experience:0,point:0,special:14},swordEmperor:{name:"剑圣",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},whiteHornSlime:{name:"尖角怪",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},badPrincess:{name:"痛苦魔女",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},badFairy:{name:"黑暗仙子",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},grayPriest:{name:"中级法师",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},redSwordsman:{name:"剑王",hp:100,atk:120,def:0,money:7,experience:0,point:0,special:6,n:8},whiteGhost:{name:"水银战士",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},poisonZombie:{name:"绿兽人",hp:100,atk:120,def:0,money:13,experience:0,point:0,special:12},magicDragon:{name:"魔龙",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},octopus:{name:"血影",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},darkFairy:{name:"仙子",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},greenKnight:{name:"强盾骑士",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},angel:{name:"天使",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},elemental:{name:"元素生物",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},steelGuard:{name:"铁守卫",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:18,value:20},evilBat:{name:"邪恶蝙蝠",hp:1000,atk:1,def:0,money:0,experience:0,point:0,special:[2,3]}};var icons_4665ee12_3a1f_44a4_bea3_0fccba634dc1={hero:{down:{loc:0,stop:0,leftFoot:1,rightFoot:3},left:{loc:1,stop:0,leftFoot:1,rightFoot:3},right:{loc:2,stop:0,leftFoot:1,rightFoot:3},up:{loc:3,stop:0,leftFoot:1,rightFoot:3},width:32,height:48},terrains:{ground:0,grass:1,grass2:2,yellowWall:3,whiteWall:4,blueWall:5,snowGround:6,ground2:7,ground3:8,ground4:9,sand:10,ground5:11,yellowWall2:12,whiteWall2:13,blueWall2:14,blockWall:15,grayWall:16,white:17,ground6:18,soil:19,ground7:20,ground8:21,ice:22,downFloor:23,upFloor:24,yellowDoor:25,blueDoor:26,redDoor:27,greenDoor:28,specialDoor:29,steelDoor:30,"blueShop-left":31,"blueShop-right":32,"pinkShop-left":33,"pinkShop-right":34,arrowUp:35,arrowDown:36,arrowLeft:37,arrowRight:38,light:39,darkLight:40,ski:41,flower:42,box:43,boxed:44,T1:45,T2:46,T3:47,T4:48,T5:49,T_1:50,T_2:51,T_3:52,T_4:53,T_5:54},animates:{star:0,lava:1,blueWater:2,water:3,yellowDoor:4,blueDoor:5,redDoor:6,greenDoor:7,specialDoor:8,steelDoor:9,yellowWall:10,whiteWall:11,blueWall:12,crystalUp:13,crystalBottom:14,starPortal:15,fire:16,portal:17,"switch":18,lavaNet:19,poisonNet:20,weakNet:21,curseNet:22,downPortal:23,leftPortal:24,rightPortal:25,upPortal:26},npcs:{man:0,woman:1,thief:2,fairy:3,magician:4,womanMagician:5,oldMan:6,child:7,wood:8,pinkShop:9,blueShop:10,princess:11,wlt:12,wt:13,wrt:14,wl:15,wc:16,wr:17,wlb:18,wrb:19,dlt:20,dt:21,drt:22,dl:23,dc:24,dr:25,dlb:26,drb:27},npc48:{npc0:0,npc1:1,npc2:2,npc3:3},enemys:{greenSlime:0,redSlime:1,blackSlime:2,slimelord:3,bat:4,bigBat:5,redBat:6,vampire:7,skeleton:8,skeletonSoilder:9,skeletonCaptain:10,ghostSkeleton:11,zombie:12,zombieKnight:13,rock:14,slimeMan:15,bluePriest:16,redPriest:17,brownWizard:18,redWizard:19,yellowGuard:20,blueGuard:21,redGuard:22,swordsman:23,soldier:24,yellowKnight:25,redKnight:26,darkKnight:27,blackKing:28,yellowKing:29,greenKing:30,blueKnight:31,goldSlime:32,poisonSkeleton:33,poisonBat:34,steelRock:35,skeletonPriest:36,skeletonKing:37,skeletonWizard:38,redSkeletonCaption:39,badHero:40,demon:41,demonPriest:42,goldHornSlime:43,redKing:44,whiteKing:45,blackMagician:46,silverSlime:47,swordEmperor:48,whiteHornSlime:49,badPrincess:50,badFairy:51,grayPriest:52,redSwordsman:53,whiteGhost:54,poisonZombie:55,magicDragon:56,octopus:57,darkFairy:58,greenKnight:59},enemy48:{angel:0,elemental:1,steelGuard:2,evilBat:3},items:{yellowKey:0,blueKey:1,redKey:2,greenKey:3,steelKey:4,bigKey:6,redJewel:16,blueJewel:17,greenJewel:18,yellowJewel:19,redPotion:20,bluePotion:21,greenPotion:22,yellowPotion:23,lifeWand:33,sword0:60,sword1:50,sword2:51,sword3:52,sword4:53,sword5:54,shield0:61,shield1:55,shield2:56,shield3:57,shield4:58,shield5:59,book:9,fly:12,pickaxe:45,icePickaxe:44,bomb:43,centerFly:13,upFly:15,downFly:14,coin:11,snow:41,cross:40,superPotion:29,earthquake:8,poisonWine:24,weakWine:25,curseWine:27,superWine:28,knife:42,moneyPocket:46,shoes:47,hammer:48,jumpShoes:49,skill1:30,wand:10},autotile:{autotile:0,autotile1:0,autotile2:0,autotile3:0}};var maps_90f36752_8815_4be8_b32b_d7fad1d0542e={"1":{cls:"terrains",id:"yellowWall",canBreak:true},"2":{cls:"terrains",id:"whiteWall",canBreak:true},"3":{cls:"terrains",id:"blueWall",canBreak:true},"4":{cls:"animates",id:"star",noPass:true},"5":{cls:"animates",id:"lava",noPass:true},"6":{cls:"terrains",id:"ice"},"7":{cls:"terrains",id:"blueShop-left"},"8":{cls:"terrains",id:"blueShop-right"},"9":{cls:"terrains",id:"pinkShop-left"},"10":{cls:"terrains",id:"pinkShop-right"},"11":{cls:"animates",id:"lavaNet",noPass:false,trigger:"passNet"},"12":{cls:"animates",id:"poisonNet",noPass:false,trigger:"passNet"},"13":{cls:"animates",id:"weakNet",noPass:false,trigger:"passNet"},"14":{cls:"animates",id:"curseNet",noPass:false,trigger:"passNet"},"15":{cls:"animates",id:"blueWater",noPass:true},"16":{cls:"animates",id:"water",noPass:true},"20":{cls:"autotile",id:"autotile",noPass:true},"21":{cls:"items",id:"yellowKey"},"22":{cls:"items",id:"blueKey"},"23":{cls:"items",id:"redKey"},"24":{cls:"items",id:"greenKey"},"25":{cls:"items",id:"steelKey"},"26":{cls:"items",id:"bigKey"},"27":{cls:"items",id:"redJewel"},"28":{cls:"items",id:"blueJewel"},"29":{cls:"items",id:"greenJewel"},"30":{cls:"items",id:"yellowJewel"},"31":{cls:"items",id:"redPotion"},"32":{cls:"items",id:"bluePotion"},"33":{cls:"items",id:"greenPotion"},"34":{cls:"items",id:"yellowPotion"},"35":{cls:"items",id:"sword1"},"36":{cls:"items",id:"shield1"},"37":{cls:"items",id:"sword2"},"38":{cls:"items",id:"shield2"},"39":{cls:"items",id:"sword3"},"40":{cls:"items",id:"shield3"},"41":{cls:"items",id:"sword4"},"42":{cls:"items",id:"shield4"},"43":{cls:"items",id:"sword5"},"44":{cls:"items",id:"shield5"},"45":{cls:"items",id:"book"},"46":{cls:"items",id:"fly"},"47":{cls:"items",id:"pickaxe"},"48":{cls:"items",id:"icePickaxe"},"49":{cls:"items",id:"bomb"},"50":{cls:"items",id:"centerFly"},"51":{cls:"items",id:"upFly"},"52":{cls:"items",id:"downFly"},"53":{cls:"items",id:"coin"},"54":{cls:"items",id:"snow"},"55":{cls:"items",id:"cross"},"56":{cls:"items",id:"superPotion"},"57":{cls:"items",id:"earthquake"},"58":{cls:"items",id:"poisonWine"},"59":{cls:"items",id:"weakWine"},"60":{cls:"items",id:"curseWine"},"61":{cls:"items",id:"superWine"},"62":{cls:"items",id:"knife"},"63":{cls:"items",id:"moneyPocket"},"64":{cls:"items",id:"shoes"},"65":{cls:"items",id:"hammer"},"68":{cls:"items",id:"lifeWand"},"69":{cls:"items",id:"jumpShoes"},"70":{cls:"items",id:"sword0"},"71":{cls:"items",id:"shield0"},"72":{cls:"items",id:"skill1"},"73":{cls:"items",id:"wand"},"81":{cls:"terrains",id:"yellowDoor",trigger:"openDoor"},"82":{cls:"terrains",id:"blueDoor",trigger:"openDoor"},"83":{cls:"terrains",id:"redDoor",trigger:"openDoor"},"84":{cls:"terrains",id:"greenDoor",trigger:"openDoor"},"85":{cls:"terrains",id:"specialDoor",trigger:"openDoor"},"86":{cls:"terrains",id:"steelDoor",trigger:"openDoor"},"87":{cls:"terrains",id:"upFloor",noPass:false},"88":{cls:"terrains",id:"downFloor",noPass:false},"89":{cls:"animates",id:"portal",noPass:false},"90":{cls:"animates",id:"starPortal",noPass:false},"91":{cls:"animates",id:"upPortal",noPass:false},"92":{cls:"animates",id:"leftPortal",noPass:false},"93":{cls:"animates",id:"downPortal",noPass:false},"94":{cls:"animates",id:"rightPortal",noPass:false},"101":{cls:"animates",id:"crystalUp"},"102":{cls:"animates",id:"crystalBottom"},"103":{cls:"animates",id:"fire"},"104":{cls:"animates",id:"switch"},"121":{cls:"npcs",id:"man"},"122":{cls:"npcs",id:"woman"},"123":{cls:"npcs",id:"thief"},"124":{cls:"npcs",id:"fairy"},"125":{cls:"npcs",id:"magician"},"126":{cls:"npcs",id:"womanMagician"},"127":{cls:"npcs",id:"oldMan"},"128":{cls:"npcs",id:"child"},"129":{cls:"npcs",id:"wood"},"130":{cls:"npcs",id:"pinkShop"},"131":{cls:"npcs",id:"blueShop"},"132":{cls:"npcs",id:"princess"},"133":{cls:"npc48",id:"npc0",faceIds:{down:"npc0",left:"npc1",right:"npc2",up:"npc3"}},"134":{cls:"npc48",id:"npc1",faceIds:{down:"npc0",left:"npc1",right:"npc2",up:"npc3"}},"135":{cls:"npc48",id:"npc2",faceIds:{down:"npc0",left:"npc1",right:"npc2",up:"npc3"}},"136":{cls:"npc48",id:"npc3",faceIds:{down:"npc0",left:"npc1",right:"npc2",up:"npc3"}},"151":{cls:"autotile",id:"autotile1",noPass:true},"152":{cls:"autotile",id:"autotile2",noPass:true},"153":{cls:"autotile",id:"autotile3",noPass:true},"161":{cls:"terrains",id:"arrowUp",noPass:false,cannotOut:["left","right","down"],cannotIn:["down"]},"162":{cls:"terrains",id:"arrowDown",noPass:false,cannotOut:["left","right","up"],cannotIn:["up"]},"163":{cls:"terrains",id:"arrowLeft",noPass:false,cannotOut:["up","down","right"],cannotIn:["right"]},"164":{cls:"terrains",id:"arrowRight",noPass:false,cannotOut:["up","down","left"],cannotIn:["left"]},"165":{cls:"terrains",id:"light",trigger:"changeLight",noPass:false},"166":{cls:"terrains",id:"darkLight",noPass:true},"167":{cls:"terrains",id:"ski",trigger:"ski",noPass:false},"168":{cls:"terrains",id:"flower",noPass:false},"169":{cls:"terrains",id:"box",trigger:"pushBox",noPass:true},"170":{cls:"terrains",id:"boxed",trigger:"pushBox",noPass:true},"181":{cls:"npcs",id:"wlt"},"182":{cls:"npcs",id:"wt"},"183":{cls:"npcs",id:"wrt"},"184":{cls:"npcs",id:"wl"},"185":{cls:"npcs",id:"wc"},"186":{cls:"npcs",id:"wr"},"187":{cls:"npcs",id:"wlb"},"188":{cls:"npcs",id:"wrb"},"189":{cls:"npcs",id:"dlt"},"190":{cls:"npcs",id:"dt"},"191":{cls:"npcs",id:"drt"},"192":{cls:"npcs",id:"dl"},"193":{cls:"npcs",id:"dc"},"194":{cls:"npcs",id:"dr"},"195":{cls:"npcs",id:"dlb"},"196":{cls:"npcs",id:"drb"},"201":{cls:"enemys",id:"greenSlime"},"202":{cls:"enemys",id:"redSlime"},"203":{cls:"enemys",id:"blackSlime"},"204":{cls:"enemys",id:"slimelord"},"205":{cls:"enemys",id:"bat"},"206":{cls:"enemys",id:"bigBat"},"207":{cls:"enemys",id:"redBat"},"208":{cls:"enemys",id:"vampire"},"209":{cls:"enemys",id:"skeleton"},"210":{cls:"enemys",id:"skeletonSoilder"},"211":{cls:"enemys",id:"skeletonCaptain"},"212":{cls:"enemys",id:"ghostSkeleton"},"213":{cls:"enemys",id:"zombie"},"214":{cls:"enemys",id:"zombieKnight"},"215":{cls:"enemys",id:"rock"},"216":{cls:"enemys",id:"slimeMan"},"217":{cls:"enemys",id:"bluePriest"},"218":{cls:"enemys",id:"redPriest"},"219":{cls:"enemys",id:"brownWizard"},"220":{cls:"enemys",id:"redWizard"},"221":{cls:"enemys",id:"yellowGuard"},"222":{cls:"enemys",id:"blueGuard"},"223":{cls:"enemys",id:"redGuard"},"224":{cls:"enemys",id:"swordsman"},"225":{cls:"enemys",id:"soldier"},"226":{cls:"enemys",id:"yellowKnight"},"227":{cls:"enemys",id:"redKnight"},"228":{cls:"enemys",id:"darkKnight"},"229":{cls:"enemys",id:"blackKing"},"230":{cls:"enemys",id:"yellowKing"},"231":{cls:"enemys",id:"greenKing"},"232":{cls:"enemys",id:"blueKnight"},"233":{cls:"enemys",id:"goldSlime"},"234":{cls:"enemys",id:"poisonSkeleton"},"235":{cls:"enemys",id:"poisonBat"},"236":{cls:"enemys",id:"steelRock"},"237":{cls:"enemys",id:"skeletonPriest"},"238":{cls:"enemys",id:"skeletonKing"},"239":{cls:"enemys",id:"skeletonWizard"},"240":{cls:"enemys",id:"redSkeletonCaption"},"241":{cls:"enemys",id:"badHero"},"242":{cls:"enemys",id:"demon"},"243":{cls:"enemys",id:"demonPriest"},"244":{cls:"enemys",id:"goldHornSlime"},"245":{cls:"enemys",id:"redKing"},"246":{cls:"enemys",id:"whiteKing"},"247":{cls:"enemys",id:"blackMagician"},"248":{cls:"enemys",id:"silverSlime"},"249":{cls:"enemys",id:"swordEmperor"},"250":{cls:"enemys",id:"whiteHornSlime"},"251":{cls:"enemys",id:"badPrincess"},"252":{cls:"enemys",id:"badFairy"},"253":{cls:"enemys",id:"grayPriest"},"254":{cls:"enemys",id:"redSwordsman"},"255":{cls:"enemys",id:"whiteGhost"},"256":{cls:"enemys",id:"poisonZombie"},"257":{cls:"enemys",id:"magicDragon"},"258":{cls:"enemys",id:"octopus"},"259":{cls:"enemys",id:"darkFairy"},"260":{cls:"enemys",id:"greenKnight"},"261":{cls:"enemy48",id:"angel"},"262":{cls:"enemy48",id:"elemental"},"263":{cls:"enemy48",id:"steelGuard"},"264":{cls:"enemy48",id:"evilBat"},"111":{cls:"terrains",id:"T1"},"112":{cls:"terrains",id:"T2"},"113":{cls:"terrains",id:"T3"},"114":{cls:"terrains",id:"T4"},"115":{cls:"terrains",id:"T5"},"116":{cls:"terrains",id:"T_1"},"117":{cls:"terrains",id:"T_2"},"118":{cls:"terrains",id:"T_3"},"119":{cls:"terrains",id:"T_4"},"120":{cls:"terrains",id:"T_5"}};var items_296f5d02_12fd_4166_a7c1_b5e830c9ee3a={items:{yellowKey:{cls:"keys",name:"黄钥匙",text:"可以打开一扇黄门"},blueKey:{cls:"keys",name:"蓝钥匙",text:"可以打开一扇蓝门"},redKey:{cls:"keys",name:"红钥匙",text:"可以打开一扇红门"},redJewel:{cls:"items",name:"红宝石",text:"'，攻击+${core.values.redJewel}'"},blueJewel:{cls:"items",name:"蓝宝石",text:"'，防御+${core.values.blueJewel}'"},greenJewel:{cls:"items",name:"绿宝石",text:"'，魔防+${core.values.greenJewel}'"},yellowJewel:{cls:"items",name:"黄宝石",text:"可以进行加点"},redPotion:{cls:"items",name:"红血瓶",text:"'，生命+'+core.values.redPotion"},bluePotion:{cls:"items",name:"蓝血瓶",text:"'，生命+'+core.values.bluePotion"},yellowPotion:{cls:"items",name:"黄血瓶",text:"'生命+'+core.values.yellowPotion"},greenPotion:{cls:"items",name:"绿血瓶",text:"'，生命+'+core.values.greenPotion"},sword0:{cls:"items",name:"破旧的剑",text:"一把已经生锈的剑",equip:{type:0,atk:0,animate:"sword"}},sword1:{cls:"items",name:"铁剑",text:"一把很普通的铁剑",equip:{type:0,atk:10,animate:"sword"}},sword2:{cls:"items",name:"银剑",text:"一把很普通的银剑",equip:{type:0,atk:20,animate:"sword"}},sword3:{cls:"items",name:"骑士剑",text:"一把很普通的骑士剑",equip:{type:0,atk:40,animate:"sword"}},sword4:{cls:"items",name:"圣剑",text:"一把很普通的圣剑",equip:{type:0,atk:80,animate:"sword"}},sword5:{cls:"items",name:"神圣剑",text:"一把很普通的神圣剑",equip:{type:0,atk:100,animate:"sword"}},shield0:{cls:"items",name:"破旧的盾",text:"一个很破旧的铁盾",equip:{type:1,def:0}},shield1:{cls:"items",name:"铁盾",text:"一个很普通的铁盾",equip:{type:1,def:10}},shield2:{cls:"items",name:"银盾",text:"一个很普通的银盾",equip:{type:1,def:20}},shield3:{cls:"items",name:"骑士盾",text:"一个很普通的骑士盾",equip:{type:1,def:40}},shield4:{cls:"items",name:"圣盾",text:"一个很普通的圣盾",equip:{type:1,def:80}},shield5:{cls:"items",name:"神圣盾",text:"一个很普通的神圣盾",equip:{type:1,def:100,mdef:100}},superPotion:{cls:"items",name:"圣水"},moneyPocket:{cls:"items",name:"金钱袋"},book:{cls:"constants",name:"怪物手册",text:"可以查看当前楼层各怪物属性"},fly:{cls:"constants",name:"楼层传送器",text:"可以自由往来去过的楼层",hideInReplay:true},coin:{cls:"constants",name:"幸运金币",text:"持有时打败怪物可得双倍金币"},snow:{cls:"constants",name:"冰冻徽章",text:"可以将面前的熔岩变成平地"},cross:{cls:"constants",name:"十字架",text:"持有后无视怪物的无敌属性"},knife:{cls:"constants",name:"屠龙匕首",text:"该道具尚未被定义"},shoes:{cls:"constants",name:"绿鞋",text:"持有时无视负面地形"},bigKey:{cls:"tools",name:"大黄门钥匙",text:"可以开启当前层所有黄门"},greenKey:{cls:"tools",name:"绿钥匙",text:"可以打开一扇绿门"},steelKey:{cls:"tools",name:"铁门钥匙",text:"可以打开一扇铁门"},pickaxe:{cls:"tools",name:"破墙镐",text:"可以破坏勇士面前的墙"},icePickaxe:{cls:"tools",name:"破冰镐",text:"可以破坏勇士面前的一堵冰墙"},bomb:{cls:"tools",name:"炸弹",text:"可以炸掉勇士面前的怪物"},centerFly:{cls:"tools",name:"中心对称飞行器",text:"可以飞向当前楼层中心对称的位置"},upFly:{cls:"tools",name:"上楼器",text:"可以飞往楼上的相同位置"},downFly:{cls:"tools",name:"下楼器",text:"可以飞往楼下的相同位置"},earthquake:{cls:"tools",name:"地震卷轴",text:"可以破坏当前层的所有墙"},poisonWine:{cls:"tools",name:"解毒药水",text:"可以解除中毒状态"},weakWine:{cls:"tools",name:"解衰药水",text:"可以解除衰弱状态"},curseWine:{cls:"tools",name:"解咒药水",text:"可以解除诅咒状态"},superWine:{cls:"tools",name:"万能药水",text:"可以解除所有不良状态"},hammer:{cls:"tools",name:"圣锤",text:"可以炸掉勇士面前的怪物"},lifeWand:{cls:"tools",name:"生命魔杖",text:"可以恢复100点生命值"},jumpShoes:{cls:"tools",name:"跳跃靴",text:"能跳跃到前方两格处"},skill1:{cls:"constants",name:"技能：二倍斩",text:"可以打开或关闭主动技能二倍斩",hideInReplay:true},wand:{cls:"items",name:"新物品"}},itemEffect:{redJewel:"core.status.hero.atk += core.values.redJewel * ratio",blueJewel:"core.status.hero.def += core.values.blueJewel * ratio",greenJewel:"core.status.hero.mdef += core.values.greenJewel * ratio",yellowJewel:"core.status.hero.hp+=1000;core.status.hero.atk+=6;core.status.hero.def+=6;core.status.hero.mdef+=10;",redPotion:"core.status.hero.hp += core.values.redPotion * ratio",bluePotion:"core.status.hero.hp += core.values.bluePotion * ratio",yellowPotion:"core.status.hero.hp += core.values.yellowPotion * ratio",greenPotion:"core.status.hero.hp += core.values.greenPotion * ratio",sword0:"core.status.hero.atk += 0",sword1:"core.status.hero.atk += 10",sword2:"core.status.hero.atk += 20",sword3:"core.status.hero.atk += 40",sword4:"core.status.hero.atk += 80",sword5:"core.status.hero.atk += 100",shield0:"core.status.hero.def += 0",shield1:"core.status.hero.def += 10",shield2:"core.status.hero.def += 20",shield3:"core.status.hero.def += 40",shield4:"core.status.hero.def += 80",shield5:"core.status.hero.def += 100;core.status.hero.mdef += 100",bigKey:"core.status.hero.items.keys.yellowKey++;core.status.hero.items.keys.blueKey++;core.status.hero.items.keys.redKey++;",superPotion:"core.status.hero.hp *= 2",moneyPocket:"core.status.hero.money += 500"},itemEffectTip:{redJewel:"'，攻击+'+core.values.redJewel * ratio",blueJewel:"'，防御+'+core.values.blueJewel * ratio",greenJewel:"'，魔防+'+core.values.greenJewel * ratio",yellowJewel:"'，全属性提升'",redPotion:"'，生命+'+core.values.redPotion * ratio",bluePotion:"'，生命+'+core.values.bluePotion * ratio",yellowPotion:"'，生命+'+core.values.yellowPotion * ratio",greenPotion:"'，生命+'+core.values.greenPotion * ratio",sword0:"'，攻击+0'",sword1:"'，攻击+10'",sword2:"'，攻击+20'",sword3:"'，攻击+40'",sword4:"'，攻击+80'",sword5:"'，攻击+100'",shield0:"'，防御+0'",shield1:"'，防御+10'",shield2:"'，防御+20'",shield3:"'，防御+40'",shield4:"'，防御+80'",shield5:"'，防御+100，魔防+100'",bigKey:"'，全钥匙+1'",superPotion:"'，生命值翻倍'",moneyPocket:"'，金币+500'"},useItemEffect:{book:"core.ui.drawBook(0);",fly:"core.ui.drawFly(core.floorIds.indexOf(core.status.floorId));",earthquake:"core.removeBlockByIds(core.status.floorId, core.status.event.ui);\ncore.drawMap(core.status.floorId, function () {\n\tcore.drawTip(core.material.items[itemId].name + '使用成功');\n});",pickaxe:"core.playSound('pickaxe.mp3');\ncore.removeBlockByIds(core.status.floorId, core.status.event.ui);\ncore.drawMap(core.status.floorId, function () {\n\tcore.drawTip(core.material.items[itemId].name + '使用成功');\n});",icePickaxe:"core.removeBlockByIds(core.status.floorId, core.status.event.ui);\ncore.drawMap(core.status.floorId, function () {\n\tcore.drawTip(core.material.items[itemId].name + '使用成功');\n});",snow:"core.removeBlockByIds(core.status.floorId, core.status.event.ui);\ncore.drawMap(core.status.floorId, function () {\n\tcore.drawTip(core.material.items[itemId].name + '使用成功');\n});",bigKey:'(function () {\n\tvar actions = core.status.event.ui.map(function (id) {\n\t\tvar block = core.status.thisMap.blocks[id];\n\t\treturn { "type": "openDoor", "loc": [block.x, block.y], "async": true };\n\t});\n\tactions.push({ "type": "waitAsync" });\n\tactions.push({ "type": "tip", "text": core.material.items[itemId].name + "使用成功" });\n\tcore.insertAction(actions);\n})();',bomb:"core.playSound('bomb.mp3');\ncore.removeBlockByIds(core.status.floorId, core.status.event.ui);\ncore.drawMap(core.status.floorId, function () {\n\tcore.drawTip(core.material.items[itemId].name + '使用成功');\n\tcore.events.afterUseBomb();\n});",hammer:"core.playSound('bomb.mp3');\ncore.removeBlockByIds(core.status.floorId, core.status.event.ui);\ncore.drawMap(core.status.floorId, function () {\n\tcore.drawTip(core.material.items[itemId].name + '使用成功');\n\tcore.events.afterUseBomb();\n});",centerFly:"core.playSound('centerFly.mp3');\ncore.clearMap('hero');\ncore.setHeroLoc('x', core.bigmap.width-1-core.getHeroLoc('x'));\ncore.setHeroLoc('y', core.bigmap.height-1-core.getHeroLoc('y'));\ncore.drawHero();\ncore.drawTip(core.material.items[itemId].name + '使用成功');",upFly:'var loc = {\'direction\': core.status.hero.loc.direction, \'x\': core.status.event.ui.x, \'y\': core.status.event.ui.y};\nif (core.status.event.id == \'action\') {\n\tcore.insertAction([\n\t\t{"type": "changeFloor", "loc": [loc.x, loc.y], "direction": loc.direction, "floorId": core.status.event.ui.id},\n\t\t{"type": "tip", "text": core.material.items[itemId].name + \'使用成功\'}\n\t]);\n}\nelse {\n\tcore.changeFloor(core.status.event.ui.id, null, loc, null, function (){\n\tcore.drawTip(core.material.items[itemId].name + \'使用成功\');\n\t\tcore.replay();\n\t});\n}',downFly:'var loc = {\'direction\': core.status.hero.loc.direction, \'x\': core.status.event.ui.x, \'y\': core.status.event.ui.y};\nif (core.status.event.id == \'action\') {\n\tcore.insertAction([\n\t\t{"type": "changeFloor", "loc": [loc.x, loc.y], "direction": loc.direction, "floorId": core.status.event.ui.id},\n\t\t{"type": "tip", "text": core.material.items[itemId].name + \'使用成功\'}\n\t]);\n}\nelse {\n\tcore.changeFloor(core.status.event.ui.id, null, loc, null, function (){\n\tcore.drawTip(core.material.items[itemId].name + \'使用成功\');\n\t\tcore.replay();\n\t});\n}\n',poisonWine:"core.removeFlag('poison');",weakWine:'core.removeFlag(\'weak\');\nif (core.values.weakValue>=1) { // >=1：直接扣数值\n\tcore.status.hero.atk += core.values.weakValue;\n\tcore.status.hero.def += core.values.weakValue;\n}\nelse { // <1：扣比例\n\tcore.addBuff("atk", core.values.weakValue);\n\tcore.addBuff("def", core.values.weakValue);\n}',curseWine:"core.removeFlag('curse');",superWine:"core.removeFlag('poison');\nif (core.hasFlag('weak')) {\n\tcore.removeFlag('weak');\n\tif (core.values.weakValue>=1) { // >=1：直接扣数值\n\t\tcore.status.hero.atk += core.values.weakValue;\n\t\tcore.status.hero.def += core.values.weakValue;\n\t}\n\telse { // <1：扣比例\n\t\tcore.addBuff(\"atk\", core.values.weakValue);\n\t\tcore.addBuff(\"def\", core.values.weakValue);\n\t}\n}\ncore.removeFlag('curse');",lifeWand:'core.insertAction([\n\t{"type": "input", "text": "请输入生命魔杖使用次数：(0-${item:lifeWand})"},\n\t{"type": "if", "condition": "flag:input<=item:lifeWand",\n\t\t"true": [\n\t\t\t{"type": "setValue", "name": "item:lifeWand", "value": "item:lifeWand-flag:input"},\n\t\t\t{"type": "setValue", "name": "status:hp", "value": "status:hp+flag:input*100"},\n\t\t\t"成功使用${flag:input}次生命魔杖，恢复${flag:input*100}点生命。"\n\t\t],\n\t\t"false": ["输入不合法！"]\n\t},\n]);\ncore.addItem(\'lifeWand\', 1);',jumpShoes:'core.insertAction({"type":"jumpHero","loc":[core.nextX(2),core.nextY(2)]});',redPotion:"core.status.hero.hp += core.values.redPotion",bluePotion:"core.status.hero.hp += core.values.bluePotion",greenPotion:"core.status.hero.hp += core.values.greenPotion",yellowPotion:"core.status.hero.hp += core.values.yellowPotion",redJewel:"core.status.hero.atk += core.values.redJewel",blueJewel:"core.status.hero.def += core.values.blueJewel",greenJewel:"core.status.hero.mdef += core.values.greenJewel",yellowJewel:'core.insertAction([\n\t{"type": "choices", "choices": [\n\t\t{"text": "攻击+1", "action": [\n\t\t\t{"type": "setValue", "name": "status:atk", "value": "status:atk+1"}\n\t\t]},\n\t\t{"text": "防御+2", "action": [\n\t\t\t{"type": "setValue", "name": "status:def", "value": "status:def+2"}\n\t\t]},\n\t\t{"text": "生命+200", "action": [\n\t\t\t{"type": "setValue", "name": "status:hp", "value": "status:hp+200"}\n\t\t]},\n\t]}\n]);',skill1:"// 二倍斩的flag:skill为1\nif (core.getFlag('skill', 0)==0) { // 判断当前是否已经开了技能\n\tif (core.getStatus('mana')>=5) { // 这里要写当前能否开技能的条件判断，比如魔力值至少要多少\n\t\tcore.setFlag('skill', 1); // 开技能1\n\t\tcore.setFlag('skillName', '二倍斩'); // 设置技能名\n\t}\n\telse {\n\t\tcore.drawTip(\"魔力不足，无法开启技能\");\n\t}\n}\nelse { // 关闭技能\n\tcore.setFlag('skill', 0); // 关闭技能状态\n\tcore.setFlag('skillName', '无');\n}"},canUseItemEffect:{book:"true",fly:"(function () {\n\treturn core.status.maps[core.status.floorId].canFlyTo;\n})();",pickaxe:"(function() {\n\tvar ids = [], id2s = [];\n\tfor (var i in core.status.thisMap.blocks) {\n\t\tvar block = core.status.thisMap.blocks[i];\n\t\tif (!block.disable && core.nearHero(block.x, block.y) && \n\t\t\t(block.event.canBreak || block.event.id == 'yellowWall' || block.event.id=='whiteWall' || block.event.id=='blueWall')) { // 能破哪些墙\n\t\t\t// 四个方向\n\t\t\tif (core.flags.pickaxeFourDirections || (block.x == core.nextX() && block.y == core.nextY()))\n\t\t\t\tids.push(i);\n\t\t\telse id2s.push(i);\n\t\t}\n\t}\n\tif (ids.length>0) {\n\t\tcore.status.event.ui = ids;\n\t\treturn true;\n\t}\n\telse if (id2s.length==1) {\n\t\tcore.status.event.ui = id2s;\n\t\treturn true;\n\t}\n\treturn false;\n})();",icePickaxe:"(function() {\n\tfor (var i in core.status.thisMap.blocks) {\n\t\tvar block = core.status.thisMap.blocks[i];\n\t\tif (!block.disable && block.x==core.nextX() && block.y==core.nextY() && block.event.id=='ice') {\n\t\t\tcore.status.event.ui = [i];\n\t\t\treturn true;\n\t\t}\n\t}\n\treturn false;\n})();",bomb:"(function () {\n\tvar ids = [], id2s = [];\n\tfor (var i in core.status.thisMap.blocks) {\n\t\tvar block = core.status.thisMap.blocks[i];\n\t\tif (!block.disable && block.event.cls.indexOf('enemy')==0 && core.nearHero(block.x, block.y)) {\n\t\t\tvar enemy = core.material.enemys[block.event.id];\n\t\t\tif (core.isset(enemy) && enemy.notBomb) continue;\n\t\t\tif (core.flags.bombFourDirections || (block.x==core.nextX() && block.y==core.nextY()))\n\t\t\t\tids.push(i);\n\t\t\telse\n\t\t\t\tid2s.push(i);\n\t\t}\n\t}\n\tif (ids.length>0) {\n\t\tcore.status.event.ui = ids;\n\t\treturn true;\n\t}\n\tif (id2s.length==1) {\n\t\tcore.status.event.ui = id2s;\n\t\treturn true;\n\t}\n\treturn false;\n})();",hammer:"(function() {\n\tvar ids = [], id2s = [];\n\tfor (var i in core.status.thisMap.blocks) {\n\t\tvar block = core.status.thisMap.blocks[i];\n\t\tif (!block.disable && block.event.cls.indexOf('enemy')==0 && core.nearHero(block.x, block.y)) {\n\t\t\tvar enemy = core.material.enemys[block.event.id];\n\t\t\tif (core.isset(enemy) && enemy.notBomb) continue;\n\t\t\tif (block.x==core.nextX() && block.y==core.nextY())\n\t\t\t\tids.push(i);\n\t\t\telse\n\t\t\t\tid2s.push(i);\n\t\t}\n\t}\n\tif (ids.length>0) {\n\t\tcore.status.event.ui = ids;\n\t\treturn true;\n\t}\n\telse if (id2s.length==1) {\n\t\tcore.status.event.ui = id2s;\n\t\treturn true;\n\t}\n\treturn false;\n})();",earthquake:"(function () {\n\tvar able=false;\n\tvar ids = [];\n\tfor (var i in core.status.thisMap.blocks) {\n\t\tvar block = core.status.thisMap.blocks[i];\n\t\tif (!block.disable &&\n\t\t\t(block.event.canBreak || block.event.id == 'yellowWall' || block.event.id == 'blueWall' || block.event.id == 'whiteWall')) { // 能炸的墙壁\n\t\t\tids.push(i);\n\t\t}\n\t}\n\tif (ids.length>0) {\n\t\tcore.status.event.ui = ids;\n\t\table=true;\n\t}\n\treturn able;\n})();",centerFly:"(function () {\n\tvar toX = core.bigmap.width-1-core.getHeroLoc('x'), toY = core.bigmap.height-1-core.getHeroLoc('y');\n\tvar id = core.getBlockId(toX, toY);\n\treturn id == null;\n})();",upFly:"(function() {\n\tvar floorId = core.status.floorId, index = core.floorIds.indexOf(floorId);\n\tif (index<core.floorIds.length-1) {\n\t\tvar toId = core.floorIds[index+1], toX = core.getHeroLoc('x'), toY = core.getHeroLoc('y');\n\t\tvar mw = core.floors[toId].width, mh = core.floors[toId].height;\n\t\tif (toX>=0 && toX<mw && toY>=0 && toY<mh && core.getBlock(toX, toY, toId)==null) {\n\t\t\tcore.status.event.ui = {'id': toId, 'x': toX, 'y': toY};\n\t\t\treturn true;\n\t\t}\n\t}\n\treturn false;\n})();",downFly:"(function() {\n\tvar floorId = core.status.floorId, index = core.floorIds.indexOf(floorId);\n\tif (index>0) {\n\t\tvar toId = core.floorIds[index-1], toX = core.getHeroLoc('x'), toY = core.getHeroLoc('y');\n\t\tvar mw = core.floors[toId].width, mh = core.floors[toId].height;\n\t\tif (toX>=0 && toX<mw && toY>=0 && toY<mh && core.getBlock(toX, toY, toId)==null) {\n\t\t\tcore.status.event.ui = {'id': toId, 'x': toX, 'y': toY};\n\t\t\treturn true;\n\t\t}\n\t}\n\treturn false;\n})();",snow:"(function () {\n\tvar ids = [], id2s = [];\n\tfor (var i in core.status.thisMap.blocks) {\n\t\tvar block = core.status.thisMap.blocks[i];\n\t\tif (!block.disable && block.event.id == 'lava' && core.nearHero(block.x, block.y)) {\n\t\t\tif (core.flags.snowFourDirections || (block.x == core.nextX() && block.y == core.nextY()))\n\t\t\t\tids.push(i);\n\t\t\telse id2s.push(i);\n\t\t}\n\t}\n\tif (ids.length>0) {\n\t\tcore.status.event.ui = ids;\n\t\treturn true;\n\t}\n\tif (id2s.length==1) {\n\t\tcore.status.event.ui = id2s;\n\t\treturn true;\n\t}\n\treturn false;\n})();",bigKey:"(function () {\n\tvar able = false,\n\t\tids = [];\n\tfor (var i in core.status.thisMap.blocks) {\n\t\tvar block = core.status.thisMap.blocks[i];\n\t\tif (!block.disable && block.event.id == 'yellowDoor') {\n\t\t\tids.push(i);\n\t\t}\n\t}\n\tif (ids.length > 0) {\n\t\tcore.status.event.ui = ids;\n\t\table = true;\n\t}\n\treturn able;\n})();",poisonWine:"core.hasFlag('poison');",weakWine:"core.hasFlag('weak');",curseWine:"core.hasFlag('curse');",superWine:"(function() {\n\treturn core.hasFlag('poison') || core.hasFlag('weak') || core.hasFlag('curse');\n})();",lifeWand:"true",jumpShoes:"(function() {\n\tvar nx=core.nextX(2), ny=core.nextY(2);\n\treturn nx>=0 && nx<core.bigmap.width && ny>=0 && ny<core.bigmap.height && core.getBlockId(nx,ny)==null;\n})();",redPotion:"true",bluePotion:"true",greenPotion:"true",yellowPotion:"true",redJewel:"true",blueJewel:"true",greenJewel:"true",yellowJewel:"true",skill1:"true"},equipCondition:{}};var functions_d6ad677b_427a_4623_b50f_a445a3b0ef8a={events:{resetGame:function(d,c,a,f,g){core.clearStatus();core.status=core.clone(core.initStatus,function(h){return h!="hero"&&h!="maps"});core.status.played=true;core.status.hero=core.clone(d);window.flags=core.status.hero.flags;core.events.setHeroIcon(core.getFlag("heroIcon","hero.png"),true);core.control._initStatistics(core.animateFrame.totalTime);core.status.hero.statistics.totalTime=core.animateFrame.totalTime=Math.max(core.status.hero.statistics.totalTime,core.animateFrame.totalTime);core.status.hero.statistics.start=null;core.status.hard=c||"";core.status.floorId=a;core.status.maps=f;core.material.enemys=core.enemys.getEnemys();core.material.items=core.items.getItems();core.items._resetItems();core.values=core.clone(core.data.values);for(var e in g||{}){core.values[e]=g[e]}core.flags=core.clone(core.data.flags);var b=core.getFlag("globalFlags",{});for(var e in b){core.flags[e]=b[e]}core._init_sys_flags();core.resize();core.updateGlobalAttribute();if(core.hasFlag("hideStatusBar")){core.hideStatusBar(core.hasFlag("showToolbox"))}else{core.showStatusBar()}core.dom.musicBtn.style.display="none"},setInitData:function(){if(core.status.hard=="Easy"){core.setFlag("hard",1)}if(core.status.hard=="Normal"){core.setFlag("hard",2)}if(core.status.hard=="Hard"){core.setFlag("hard",3)}if(core.status.hard=="Hell"){core.setFlag("hard",4)}core.setFlag("__visited__",{})},win:function(c,b,a){if(a){core.status.extraEvent=core.clone(core.status.event)}core.ui.closePanel();var d=core.isReplaying();if(d){core.stopReplay()}core.waitHeroToStop(function(){if(!a){core.clearMap("all");core.deleteAllCanvas();core.dom.gif2.innerHTML=""}core.drawText(["\t["+(c||"恭喜通关")+(core.getFlag("GEL",0)?" (GEL)":"")+"]你的分数是${status:hp}。"],function(){core.events.gameOver(c||"",d,b)})})},lose:function(a){core.ui.closePanel();var b=core.isReplaying();core.stopReplay();core.waitHeroToStop(function(){core.drawText(["\t["+(a||"结局1")+"]你死了。\n如题。"],function(){core.events.gameOver(null,b)})})},changingFloor:function(d,f,e){var c=core.status.floorId||null;if(!core.hasFlag("__leaveLoc__")){core.setFlag("__leaveLoc__",{})}if(c!=null){core.getFlag("__leaveLoc__")[c]=core.status.hero.loc}core.maps.resizeMap(d);if(!e){core.status.maps[d].blocks.forEach(function(h){if(h.disable&&core.enemys.hasSpecial(h.event.id,23)){h.disable=false}})}core.status.hero.loc=f;core.control.gatherFollowers();core.drawMap(d);if(core.status.maps[d].bgm){var a=core.status.maps[d].bgm;if(a instanceof Array){a=a[0]}if(!core.hasFlag("__bgm__")){core.playBgm(a)}}var b=core.getFlag("__color__",null);if(!b&&core.status.maps[d].color){b=core.status.maps[d].color}core.clearMap("curtain");core.status.curtainColor=b;if(b){core.fillRect("curtain",0,0,core.__PIXELS__,core.__PIXELS__,core.arrayToRGBA(b))}var g=core.getFlag("__weather__",null);if(!g&&core.status.maps[d].weather){g=core.status.maps[d].weather}if(g){core.setWeather(g[0],g[1])}else{core.setWeather()}},afterChangeFloor:function(a,b){if(b){core.events.recoverEvents(core.getFlag("__events__"));core.removeFlag("__events__")}else{core.insertAction(core.floors[a].eachArrive);if(!core.hasVisitedFloor(a)){core.insertAction(core.floors[a].firstArrive);core.visitFloor(a)}}},flyTo:function(f,a){var b=core.status.floorId;if(!core.status.maps[b].canFlyTo||!core.status.maps[f].canFlyTo||!core.hasVisitedFloor(f)){core.drawTip("无法飞往"+core.status.maps[f].title+"！");return false}var e=null,d=null;if(core.flags.flyRecordPosition){d=core.getFlag("__leaveLoc__",{})[f]||null}if(d==null){var c=core.floorIds.indexOf(b),g=core.floorIds.indexOf(f);var e=c<=g?"downFloor":"upFloor";if(c==g&&core.status.maps[b].underGround){e="upFloor"}}core.status.route.push("fly:"+f);core.ui.closePanel();core.changeFloor(f,e,d,null,a);return true},beforeBattle:function(c,f,g){if(f!=null&&g!=null){var e=f+","+g,b=core.status.checkBlock.cache[e]||{},d=b.guards||[];if(d.length>0){core.setFlag("__guards__"+f+"_"+g,d);var a=[];d.forEach(function(h){core.push(a,{type:"jump",from:[h[0],h[1]],to:[f,g],time:300,keep:false,async:true})});core.push(a,[{type:"waitAsync"},{type:"trigger",loc:[f,g]}]);core.insertAction(a);return false}}return true},afterBattle:function(d,o,p,a){var c=core.material.enemys[d];var e="hand",f=(core.status.hero.equipment||[])[0];if(f&&(core.material.items[f].equip||{}).animate){e=core.material.items[f].equip.animate}if(!(core.material.animates[e]||{}).se){core.playSound("attack.mp3")}core.drawAnimate(e,o!=null?o:core.getHeroLoc("x"),p!=null?p:core.getHeroLoc("y"));var b=core.enemys.getDamage(d,o,p);if(b==null){b=core.status.hero.hp+1}core.status.hero.hp-=b;core.status.hero.statistics.battleDamage+=b;core.status.hero.statistics.battle++;if(core.status.hero.hp<=0){core.status.hero.hp=0;core.updateStatusBar();core.events.lose("战斗失败");return}var h=[];if(o!=null&&p!=null){core.removeBlock(o,p);h=core.getFlag("__guards__"+o+"_"+p,[]);core.removeFlag("__guards__"+o+"_"+p)}var j=h.reduce(function(q,r){return q+core.material.enemys[r[2]].money},c.money);if(core.hasItem("coin")){j*=2}if(core.hasFlag("curse")){j=0}core.status.hero.money+=j;core.status.hero.statistics.money+=j;var g=h.reduce(function(q,r){return q+core.material.enemys[r[2]].experience},c.experience);if(core.hasFlag("curse")){g=0}core.status.hero.experience+=g;core.status.hero.statistics.experience+=g;var i="打败 "+c.name;if(core.flags.enableMoney){i+="，金币+"+j}if(core.flags.enableExperience){i+="，经验+"+g}core.drawTip(i,c.id);var n=[];var m=c.special;if(core.enemys.hasSpecial(m,12)){core.push(n,[{type:"insert",name:"毒衰咒处理",args:[0]}])}if(core.enemys.hasSpecial(m,13)){core.push(n,[{type:"insert",name:"毒衰咒处理",args:[1]}])}if(core.enemys.hasSpecial(m,14)){core.push(n,[{type:"insert",name:"毒衰咒处理",args:[2]}])}if(core.flags.hatredDecrease&&core.enemys.hasSpecial(m,17)){core.setFlag("hatred",Math.floor(core.getFlag("hatred",0)/2))}if(core.enemys.hasSpecial(m,19)){core.status.hero.statistics.battleDamage+=core.status.hero.hp-1;core.status.hero.hp=1}if(core.enemys.hasSpecial(m,21)){core.status.hero.atk-=(c.atkValue||0);core.status.hero.def-=(c.defValue||0);if(core.status.hero.atk<0){core.status.hero.atk=0}if(core.status.hero.def<0){core.status.hero.def=0}}core.setFlag("hatred",core.getFlag("hatred",0)+core.values.hatred);if(core.flags.enableSkill){var l=core.getFlag("skill",0);if(l==1){core.status.hero.mana-=5}core.setFlag("skill",0);core.setFlag("skillName","无")}var k=core.material.enemys[d].point;if(core.flags.enableAddPoint&&k>0){core.push(n,[{type:"insert",name:"加点事件",args:[k]}])}core.push(n,core.floors[core.status.floorId].afterBattle[o+","+p]);if(n.length>0){core.insertAction(n,o,p)}core.updateStatusBar();if(core.status.event.id==null){core.continueAutomaticRoute()}else{core.clearContinueAutomaticRoute()}if(a){a()}},afterOpenDoor:function(b,e,f,a){var d=[];var c=core.floors[core.status.floorId].afterOpenDoor[e+","+f];if(c){core.unshift(d,c)}if(d.length>0){core.insertAction(d,e,f)}if(core.status.event.id==null){core.continueAutomaticRoute()}else{core.clearContinueAutomaticRoute()}if(a){a()}},afterGetItem:function(c,e,f,a){core.playSound("item.mp3");var d=[];var b=core.floors[core.status.floorId].afterGetItem[e+","+f];if(b){core.unshift(d,b)}if(d.length>0){core.insertAction(d,e,f)}if(a){a()}},afterChangeLight:function(a,b){},afterPushBox:function(){if(core.searchBlock("box").length==0){}},afterUseBomb:function(){},afterPassNet:function(b,c,a){},canUseQuickShop:function(a){if(core.status.thisMap.canUseQuickShop===false){return"当前楼层不能使用快捷商店。"}return null}},enemys:{getSpecials:function(){return[[1,"先攻","怪物首先攻击"],[2,"魔攻","怪物无视勇士的防御"],[3,"坚固","勇士每回合最多只能对怪物造成1点伤害"],[4,"2连击","怪物每回合攻击2次"],[5,"3连击","怪物每回合攻击3次"],[6,function(a){return(a.n||4)+"连击"},function(a){return"怪物每回合攻击"+(a.n||4)+"次"}],[7,"破甲","战斗前，怪物附加角色防御的"+Math.floor(100*core.values.breakArmor||0)+"%作为伤害"],[8,"反击","战斗时，怪物每回合附加角色攻击的"+Math.floor(100*core.values.counterAttack||0)+"%作为伤害，无视角色防御"],[9,"净化","战斗前，怪物附加勇士魔防的"+core.values.purify+"倍作为伤害"],[10,"模仿","怪物的攻防和勇士攻防相等"],[11,"吸血",function(a){return"战斗前，怪物首先吸取角色的"+Math.floor(100*a.value||0)+"%生命（约"+Math.floor((a.value||0)*core.getStatus("hp"))+"点）作为伤害"+(a.add?"，并把伤害数值加到自身生命上":"")}],[12,"中毒","战斗后，勇士陷入中毒状态，每一步损失生命"+core.values.poisonDamage+"点"],[13,"衰弱","战斗后，勇士陷入衰弱状态，攻防暂时下降"+(core.values.weakValue>=1?core.values.weakValue+"点":parseInt(core.values.weakValue*100)+"%")],[14,"诅咒","战斗后，勇士陷入诅咒状态，战斗无法获得金币和经验"],[15,"领域",function(a){return"经过怪物周围"+(a.zoneSquare?"九宫格":"十字")+"范围内"+(a.range||1)+"格时自动减生命"+(a.value||0)+"点"}],[16,"夹击","经过两只相同的怪物中间，勇士生命值变成一半"],[17,"仇恨","战斗前，怪物附加之前积累的仇恨值作为伤害"+(core.flags.hatredDecrease?"；战斗后，释放一半的仇恨值":"")+"。（每杀死一个怪物获得"+(core.values.hatred||0)+"点仇恨值）"],[18,"阻击",function(a){return"经过怪物的十字领域时自动减生命"+(a.value||0)+"点，同时怪物后退一格"}],[19,"自爆","战斗后勇士的生命值变成1"],[20,"无敌","勇士无法打败怪物，除非拥有十字架"],[21,"退化",function(a){return"战斗后勇士永久下降"+(a.atkValue||0)+"点攻击和"+(a.defValue||0)+"点防御"}],[22,"固伤",function(a){return"战斗前，怪物对勇士造成"+(a.damage||0)+"点固定伤害，无视勇士魔防。"}],[23,"重生","怪物被击败后，角色转换楼层则怪物将再次出现"],[24,"激光",function(a){return"经过怪物同行或同列时自动减生命"+(a.value||0)+"点"}],[25,"光环",function(a){return"同楼层所有怪物生命提升"+(a.value||0)+"%，攻击提升"+(a.atkValue||0)+"%，防御提升"+(a.defValue||0)+"%，"+(a.add?"可叠加":"不可叠加")}],[26,"支援","当周围一圈的怪物受到攻击时将上前支援，并组成小队战斗。"],[27,"捕捉","当走到怪物周围十字时会强制进行战斗。"]]},getEnemyInfo:function(e,h,w,z,f){f=f||core.status.floorId;var k=core.getRealStatusOrDefault(h,"hp"),i=core.getRealStatusOrDefault(h,"atk"),j=core.getRealStatusOrDefault(h,"def"),l=core.getRealStatusOrDefault(h,"mdef");var r=e.hp,o=e.atk,p=e.def,u=e.special;var s=e.money,q=e.experience,t=e.point;if(core.hasSpecial(u,10)){o=i;p=j}if(core.hasSpecial(u,3)&&p<i-1){p=i-1}var g=[];var v=function(){var x=["MTx"];return core.inArray(x,f)};if(v()){var m=0,a=0,d=0,c=0;var n=w!=null&&z!=null?(w+","+z):"floor";if(!core.status.checkBlock){core.status.checkBlock={}}if(!core.status.checkBlock.cache){core.status.checkBlock.cache={}}var b=core.status.checkBlock.cache[n];if(!b){core.status.maps[f].blocks.forEach(function(x){if(!x.disable){var A=x.event.id,y=core.material.enemys[A];if(y&&core.hasSpecial(y.special,25)){if(y.add||c==0){m+=y.value||0;a+=y.atkValue||0;d+=y.defValue||0;c++}}if(y&&core.hasSpecial(y.special,26)&&w!=null&&z!=null&&Math.abs(x.x-w)<=1&&Math.abs(x.y-z)<=1&&!(w==x.x&&z==x.y)){g.push([x.x,x.y,A])}}});core.status.checkBlock.cache[n]={hp_buff:m,atk_buff:a,def_buff:d,guards:g}}else{m=b.hp_buff;a=b.atk_buff;d=b.def_buff;g=b.guards}r*=(1+m/100);o*=(1+a/100);p*=(1+d/100)}return{hp:Math.floor(r),atk:Math.floor(o),def:Math.floor(p),money:Math.floor(s),experience:Math.floor(q),point:Math.floor(t),special:u,guards:g,}},getDamageInfo:function(c,l,G,H,e){e=e||core.status.floorId;var o=core.getRealStatusOrDefault(l,"hp"),m=core.getRealStatusOrDefault(l,"atk"),n=core.getRealStatusOrDefault(l,"def"),p=core.getRealStatusOrDefault(l,"mdef"),C=core.getStatusOrDefault(l,"hp"),A=core.getStatusOrDefault(l,"atk"),B=core.getStatusOrDefault(l,"def");o=Math.max(0,o);m=Math.max(0,m);n=Math.max(0,n);p=Math.max(0,p);var d=core.enemys.getEnemyInfo(c,l,G,H,e);var w=d.hp,u=d.atk,v=d.def,z=d.special;if(core.getFlag("skill",0)==1){m*=2}if(core.hasSpecial(z,20)&&!core.hasItem("cross")){return null}var t=0;if(core.hasSpecial(z,11)){var F=o*c.value;F=Math.floor(F)||0;if(c.add){w+=F}t+=F}var D=u-n;if(core.hasSpecial(z,2)){D=u}if(D<0){D=0}if(core.hasSpecial(z,4)){D*=2}if(core.hasSpecial(z,5)){D*=3}if(core.hasSpecial(z,6)){D*=(c.n||4)}var a=0;if(core.hasSpecial(z,8)){a+=Math.floor(core.values.counterAttack*m)}if(core.hasSpecial(z,1)){t+=D}if(core.hasSpecial(z,7)){t+=Math.floor(core.values.breakArmor*n)}if(core.hasSpecial(z,9)){t+=Math.floor(core.values.purify*p)}var q=Math.max(m-v,0);if(q<=0){return null}var E=Math.ceil(w/q);var h=core.getFlag("__guards__"+G+"_"+H,d.guards);var g=false;E+=core.getFlag("__extraTurn__",0);if(h.length>0){if(!g){core.setFlag("__extraTurn__",E)}for(var r=0;r<h.length;r++){var j=h[r][0],k=h[r][1],f=h[r][2];var s=core.enemys.getDamageInfo(core.material.enemys[f],{hp:C,atk:A,def:B,mdef:0});if(s==null){return null}core.setFlag("__extraTurn__",s.turn);t+=s.damage}if(g){E+=core.getFlag("__extraTurn__",0)}}core.removeFlag("__extraTurn__");var b=t+(E-1)*D+E*a;b-=p;if(!core.flags.enableNegativeDamage){b=Math.max(0,b)}return{mon_hp:Math.floor(w),mon_atk:Math.floor(u),mon_def:Math.floor(v),init_damage:Math.floor(t),per_damage:Math.floor(D),hero_per_damage:Math.floor(q),turn:Math.floor(E),damage:Math.floor(b)}}},actions:{onKeyUp:function(d,a){if(core.isMoving()){return}if(a&&d>=48&&d<=57){core.items.quickLoadEquip(d-48);return}switch(d){case 27:core.openSettings(true);break;case 88:core.openBook(true);break;case 71:core.useFly(true);break;case 65:core.doSL("autoSave","load");break;case 83:core.save(true);break;case 68:core.load(true);break;case 69:core.ui.drawCursor();break;case 84:core.openToolbox(true);break;case 81:core.openEquipbox(true);break;case 90:core.turnHero();break;case 75:case 86:core.openQuickShop(true);break;case 32:core.getNextItem();break;case 82:core.actions._clickSyncSave_replay();break;case 33:case 34:core.ui.drawMaps();break;case 77:core.ui.drawPaint();break;case 66:core.ui.drawStatistics();break;case 72:core.ui.drawHelp();break;case 78:core.confirmRestart();break;case 79:core.actions._clickGameInfo_openProject();break;case 80:core.actions._clickGameInfo_openComments();break;case 49:if(core.hasItem("pickaxe")){if(core.canUseItem("pickaxe")){core.status.route.push("key:49");core.useItem("pickaxe",true)}else{core.drawTip("当前不能使用破墙镐")}}break;case 50:if(core.hasItem("bomb")){if(core.canUseItem("bomb")){core.status.route.push("key:50");core.useItem("bomb",true)}else{core.drawTip("当前不能使用炸弹")}}else{if(core.hasItem("hammer")){if(core.canUseItem("hammer")){core.status.route.push("key:50");core.useItem("hammer",true)}else{core.drawTip("当前不能使用圣锤")}}}break;case 51:if(core.hasItem("centerFly")){core.ui.drawCenterFly()}break;case 52:var e=["icePickaxe","snow","earthquake","upFly","downFly","jumpShoes","lifeWand","poisonWine","weakWine","curseWine","superWine"];for(var b=0;b<e.length;b++){var c=e[b];if(core.canUseItem(c)){core.status.route.push("key:52");core.useItem(c,true);break}}break;case 55:core.getNextItem();break;case 118:core.debug();break;case 87:if(core.hasItem("skill1")){core.status.route.push("key:87");core.useItem("skill1",true)}break}}},control:{saveData:function(){var d={};for(var b in core.values){if(!core.same(core.values[b],core.data.values[b])){d[b]=core.clone(core.values[b])}}var a={floorId:core.status.floorId,hero:core.clone(core.status.hero),hard:core.status.hard,maps:core.maps.saveMap(),route:core.encodeRoute(core.status.route),values:d,shops:{},version:core.firstData.version,time:new Date().getTime()};if(core.flags.checkConsole){a.hashCode=core.utils.hashCode(a.hero)}for(var c in core.status.shops){a.shops[c]={times:core.status.shops[c].times||0,visited:core.status.shops[c].visited||false}}return a},loadData:function(b,a){core.resetGame(b.hero,b.hard,b.floorId,core.maps.loadMap(b.maps),b.values);core.status.route=core.decodeRoute(b.route);for(var d in core.status.shops){if(b.shops[d]){core.status.shops[d].times=b.shops[d].times;core.status.shops[d].visited=b.shops[d].visited}}core.status.textAttribute=core.getFlag("textAttribute",core.status.textAttribute);var e=core.getFlag("globalAttribute",core.status.globalAttribute);if(!core.same(e,core.status.globalAttribute)){core.status.globalAttribute=e;core.updateGlobalAttribute()}core.events.setVolume(core.getFlag("__volume__",1),0);var c=core.getFlag("heroIcon","hero.png");c=core.getMappedName(c);if(core.material.images.images[c]){core.material.images.hero=core.material.images.images[c];core.material.icons.hero.width=core.material.images.images[c].width/4;core.material.icons.hero.height=core.material.images.images[c].height/4}core.changeFloor(b.floorId,null,b.hero.loc,0,function(){if(core.hasFlag("__bgm__")){core.playBgm(core.getFlag("__bgm__"))}if(a){a()}},true)},updateStatusBar:function(){core.events.checkLvUp();if(core.flags.enableHPMax){core.setStatus("hp",Math.min(core.getStatus("hpmax"),core.getStatus("hp")))}if(core.status.floorId){core.setStatusBarInnerHTML("floor",core.status.maps[core.status.floorId].name)}core.setStatusBarInnerHTML("name",core.getStatus("name"));core.setStatusBarInnerHTML("lv",core.getLvName());var c=["hpmax","hp","mana","atk","def","mdef","money","experience"];c.forEach(function(d){core.status.hero[d]=Math.floor(core.status.hero[d]);core.setStatusBarInnerHTML(d,core.getRealStatus(d))});if(core.flags.enableMana){if(core.status.hero.manamax!=null&&core.getRealStatus("manamax")>=0){core.status.hero.mana=Math.min(core.status.hero.mana,core.getRealStatus("manamax"));core.setStatusBarInnerHTML("mana",core.status.hero.mana+"/"+core.getRealStatus("manamax"))}else{core.setStatusBarInnerHTML("mana",core.status.hero.mana)}}if(core.flags.enableSkill){core.setStatusBarInnerHTML("skill",core.getFlag("skillName","无"))}if(core.flags.enableLevelUp&&core.status.hero.lv<core.firstData.levelUp.length){var b=core.calValue(core.firstData.levelUp[core.status.hero.lv].need);if(core.flags.levelUpLeftMode){core.setStatusBarInnerHTML("up",core.formatBigNumber(b-core.getStatus("experience"))||"")}else{core.setStatusBarInnerHTML("up",core.formatBigNumber(b)||"")}}else{core.setStatusBarInnerHTML("up","")}var a=["yellowKey","blueKey","redKey"];a.forEach(function(d){core.setStatusBarInnerHTML(d,core.setTwoDigits(core.itemCount(d)))});if(core.flags.enableDebuff){core.setStatusBarInnerHTML("poison",core.hasFlag("poison")?"毒":"");core.setStatusBarInnerHTML("weak",core.hasFlag("weak")?"衰":"");core.setStatusBarInnerHTML("curse",core.hasFlag("curse")?"咒":"")}if(core.flags.enablePZF){core.setStatusBarInnerHTML("pickaxe","破"+core.itemCount("pickaxe"));core.setStatusBarInnerHTML("bomb","炸"+core.itemCount("bomb"));core.setStatusBarInnerHTML("fly","飞"+core.itemCount("centerFly"))}core.statusBar.hard.innerText=core.status.hard;core.drawStatusBar();core.updateCheckBlock();core.updateDamage()},updateCheckBlock:function(m){m=m||core.status.floorId;if(!m||!core.status.maps){return}var F=core.floors[m].width,n=core.floors[m].height;var c=core.getMapBlocksObj(m);var f={},D={},B={},a={};for(var r in c){var b=c[r],G=b.x,H=b.y,o=b.event.id,j=core.material.enemys[o];if(o=="lavaNet"&&b.event.trigger=="passNet"&&!core.hasItem("shoes")){f[r]=(f[r]||0)+core.values.lavaDamage;D[r]="血网伤害"}if(j&&core.hasSpecial(j.special,15)&&!core.hasFlag("no_zone")){var u=j.range||1;var I=false;if(j.zoneSquare!=null){I=j.zoneSquare}for(var h=-u;h<=u;h++){for(var i=-u;i<=u;i++){if(h==0&&i==0){continue}var s=G+h,t=H+i,e=s+","+t;if(s<0||s>=F||t<0||t>=n){continue}if(!I&&Math.abs(h)+Math.abs(i)>u){continue}f[e]=(f[e]||0)+(j.value||0);D[e]="领域伤害"}}}if(j&&core.hasSpecial(j.special,18)&&!core.hasFlag("no_snipe")){for(var g in core.utils.scan){var s=G+core.utils.scan[g].x,t=H+core.utils.scan[g].y,e=s+","+t;if(s<0||s>=F||t<0||t>=n){continue}f[e]=(f[e]||0)+(j.value||0);D[e]="阻击伤害";var v=core.reverseDirection(g);var z=G+core.utils.scan[v].x,A=H+core.utils.scan[v].y;if(z>=0&&z<F&&A>=0&&A<n&&core.getBlock(z,A,m)==null){B[e]=(B[e]||[]).concat([[G,H,o,v]])}}}if(j&&core.hasSpecial(j.special,24)&&!core.hasFlag("no_laser")){for(var s=0;s<F;s++){var e=s+","+H;if(s!=G){f[e]=(f[e]||0)+(j.value||0);D[e]="激光伤害"}}for(var t=0;t<n;t++){var e=G+","+t;if(t!=H){f[e]=(f[e]||0)+(j.value||0);D[e]="激光伤害"}}}if(j&&core.enemys.hasSpecial(j.special,27)){for(var g in core.utils.scan){var s=G+core.utils.scan[g].x,t=H+core.utils.scan[g].y,e=s+","+t;if(s<0||s>=F||t<0||t>=n){continue}a[e]=(a[e]||[]).concat([[G,H,o,g]])}}}if(!core.hasFlag("no_betweenAttack")){for(var G=0;G<F;G++){for(var H=0;H<n;H++){var r=G+","+H;var l=null;var p=c[(G-1)+","+H],w=c[(G+1)+","+H];if(p&&w&&p.id==w.id){if(core.hasSpecial(p.event.id,16)){l=p.event.id}}var C=c[G+","+(H-1)],d=c[G+","+(H+1)];if(C&&d&&C.id==d.id){if(core.hasSpecial(C.event.id,16)){l=C.event.id}}if(l!=null){var q=core.status.hero.hp-(f[r]||0);if(q>1){var E=Math.floor((q+(core.flags.betweenAttackCeil?1:0))/2);if(core.flags.betweenAttackMax){var k=core.getDamage(l,G,H,m);if(k!=null&&k<E){E=k}}if(E>0){f[r]=(f[r]||0)+E;D[r]="夹击伤害"}}}}}}core.status.checkBlock={damage:f,type:D,snipe:B,ambush:a,cache:{}}},moveOneStep:function(a,b){core.setHeroLoc("x",a,true);core.setHeroLoc("y",b,true);core.status.hero.steps++;core.updateFollowers();core.drawHero();if(core.hasFlag("poison")){core.status.hero.statistics.poisonDamage+=core.values.poisonDamage;core.status.hero.hp-=core.values.poisonDamage;if(core.status.hero.hp<=0){core.status.hero.hp=0;core.updateStatusBar();core.events.lose();return}}core.updateStatusBar()},moveDirectly:function(c,d,a){if(a==null){a=core.canMoveDirectly(c,d)}if(a>=0){core.clearMap("hero");var b=core.status.route[core.status.route.length-1];if(["left","right","up","down"].indexOf(b)>=0){core.setHeroLoc("direction",b)}core.setHeroLoc("x",c);core.setHeroLoc("y",d);core.drawHero();core.status.route.push("move:"+c+":"+d);core.status.hero.statistics.moveDirectly++;core.status.hero.statistics.ignoreSteps+=a;return true}return false},parallelDo:function(timestamp){if(!core.isPlaying()){return}if(core.status.floorId){try{eval(core.floors[core.status.floorId].parallelDo)}catch(e){main.log(e)}}if(core.status.floorId=="time"){if(!core.T){core.T=timestamp}else{core.status.hero.mdef-=timestamp-core.T,core.T=timestamp}if(core.status.hero.mdef<=0){core.status.hero.mdef=0}core.updateStatusBar();if(core.status.hero.mdef<=0){core.insertAction([{type:"playSound",name:"gameover.mp3"},{type:"if",condition:"flag:___==30000","true":[{type:"win",reason:"30 sec"}]},{type:"if",condition:"flag:___==60000","true":[{type:"win",reason:"60 sec"}]}])}}}},ui:{drawStatusBar:function(){if(!core.flags.statusCanvas){return}var a=core.dom.statusCanvas,b=core.dom.statusCanvasCtx;b.clearRect(0,0,a.width,a.height);if(!core.domStyle.showStatusBar){return}b.fillStyle=core.status.globalAttribute.statusBarColor||core.initStatus.globalAttribute.statusBarColor;b.font="italic bold 18px Verdana";var d=6,i=9,e=39;if(core.domStyle.isVertical){d=6;i=6;e=32}var h=["floor","hp","atk","def","mdef","money"];for(var c=0;c<h.length;c++){var f=h[c];b.drawImage(core.statusBar.icons[f],d,i,25,25);var g=(core.statusBar[f]||{}).innerText||" ";if(!/^[-a-zA-Z0-9`~!@#$%^&*()_=+\[{\]}\\|;:'",<.>\/?]*$/.test(g)){b.font="bold 18px Verdana"}b.fillText(g,d+36,i+20);b.font="italic bold 18px Verdana";if(core.domStyle.isVertical){if(c%3!=2){d+=131}else{d=6;i+=e}}else{i+=e}}b.fillStyle="#FFCCAA";b.fillText(core.statusBar.yellowKey.innerText,d+5,i+20);b.fillStyle="#AAAADD";b.fillText(core.statusBar.blueKey.innerText,d+40,i+20);b.fillStyle="#FF8888";b.fillText(core.statusBar.redKey.innerText,d+75,i+20)},drawStatistics:function(){return["yellowDoor","blueDoor","redDoor","greenDoor","steelDoor","yellowKey","blueKey","redKey","greenKey","steelKey","redJewel","blueJewel","greenJewel","yellowJewel","redPotion","bluePotion","greenPotion","yellowPotion","superPotion","pickaxe","bomb","centerFly","icePickaxe","snow","earthquake","upFly","downFly","jumpShoes","lifeWand","poisonWine","weakWine","curseWine","superWine","sword1","sword2","sword3","sword4","sword5","shield1","shield2","shield3","shield4","shield5",]},drawAbout:function(){core.ui.closePanel();core.lockControl();core.status.event.id="about";var c=48,f=36,d=core.__PIXELS__-2*c,a=core.__PIXELS__-2*f;core.setAlpha("ui",0.85);core.fillRect("ui",c,f,d,a,"#000000");core.setAlpha("ui",1);core.strokeRect("ui",c-1,f-1,d+1,a+1,"#FFFFFF",2);var e=c+24;core.setTextAlign("ui","left");var b=(core.status.globalAttribute||core.initStatus.globalAttribute).font;core.fillText("ui","消灭星星",e,f+35,"#FFD700","bold 22px "+b);core.fillText("ui","作者： bdf",e,f+112)}}};var events_c12a15a8_c380_4b28_8144_256cba95f760={commonEvent:{"加点事件":[{type:"comment",text:"通过传参，flag:arg1 表示当前应该的加点数值"},{type:"choices",choices:[{text:"攻击+${1*flag:arg1}",action:[{type:"setValue",name:"status:atk",value:"status:atk+1*flag:arg1"}]},{text:"防御+${2*flag:arg1}",action:[{type:"setValue",name:"status:def",value:"status:def+2*flag:arg1"}]},{text:"生命+${200*flag:arg1}",action:[{type:"setValue",name:"status:hp",value:"status:hp+200*flag:arg1"}]}]}],"毒衰咒处理":[{type:"comment",text:"获得毒衰咒效果，flag:arg1 为要获得的类型"},{type:"switch",condition:"flag:arg1",caseList:[{"case":"0",action:[{type:"comment",text:"获得毒效果"},{type:"if",condition:"!flag:poison","true":[{type:"setValue",name:"flag:poison",value:"true"}],"false":[]}]},{"case":"1",action:[{type:"comment",text:"获得衰效果"},{type:"if",condition:"!flag:weak","true":[{type:"setValue",name:"flag:weak",value:"true"},{type:"if",condition:"core.values.weakValue>=1","true":[{type:"comment",text:">=1：直接扣数值"},{type:"addValue",name:"status:atk",value:"-core.values.weakValue"},{type:"addValue",name:"status:def",value:"-core.values.weakValue"}],"false":[{type:"comment",text:"<1：扣比例"},{type:"function","function":"function(){\ncore.addBuff('atk', -core.values.weakValue);\n}"},{type:"function","function":"function(){\ncore.addBuff('def', -core.values.weakValue);\n}"}]}],"false":[]}]},{"case":"2",action:[{type:"comment",text:"获得咒效果"},{type:"if",condition:"!flag:curse","true":[{type:"setValue",name:"flag:curse",value:"true"}],"false":[]}]}]}],"滑冰事件":[{type:"comment",text:"公共事件：滑冰事件"},{type:"if",condition:"core.canMoveHero()","true":[{type:"comment",text:"检测下一个点是否可通行"},{type:"setValue",name:"flag:nx",value:"core.nextX()"},{type:"setValue",name:"flag:ny",value:"core.nextY()"},{type:"if",condition:"core.noPass(flag:nx, flag:ny)","true":[{type:"comment",text:"不可通行，触发下一个点的事件"},{type:"trigger",loc:["flag:nx","flag:ny"]}],"false":[{type:"comment",text:"可通行，先移动到下个点，然后检查阻激夹域，并尝试触发该点事件"},{type:"moveHero",time:80,steps:["forward"]},{type:"function","function":"function(){\ncore.checkBlock();\n}"},{type:"comment",text:"【触发事件】如果该点存在事件则会立刻结束当前事件"},{type:"trigger",loc:["flag:nx","flag:ny"]},{type:"comment",text:"如果该点不存在事件，则继续检测该点是否是滑冰点"},{type:"if",condition:"core.getBgNumber() == 167","true":[{type:"function","function":'function(){\ncore.insertAction("滑冰事件",null,null,null,true)\n}'}],"false":[]}]}],"false":[]}],"回收钥匙商店":[{type:"comment",text:"此事件在全局商店中被引用了(全局商店keyShop1)"},{type:"comment",text:"解除引用前勿删除此事件"},{type:"comment",text:"玩家在快捷列表（V键）中可以使用本公共事件"},{type:"while",condition:"1",data:[{type:"choices",text:"\t[商人,woman]你有多余的钥匙想要出售吗？",choices:[{text:"黄钥匙（10金币）",color:[255,255,0,1],action:[{type:"if",condition:"item:yellowKey >= 1","true":[{type:"addValue",name:"item:yellowKey",value:"-1"},{type:"addValue",name:"status:money",value:"10"}],"false":["\t[商人,woman]你没有黄钥匙！"]}]},{text:"蓝钥匙（50金币）",color:[0,0,255,1],action:[{type:"if",condition:"item:blueKey >= 1","true":[{type:"addValue",name:"item:blueKey",value:"-1"},{type:"addValue",name:"status:money",value:"50"}],"false":["\t[商人,woman]你没有蓝钥匙！"]}]},{text:"离开",action:[{type:"exit"}]}]}]}],draw:[{type:"function","function":"function(){\ncore.fs();for(var i=1;i<=10;i++)for(var j=1;j<=10;j++)core.setBlock((core.getFlag('mp')[i][j]?core.getFlag('mp')[i][j]+110:0)+(core.group&&core.group==core.getFlag('grp')[i][j]?5:0),i-1,13-j);core.setStatus('money',core.getFlag('v')[core.group]);core.setStatus('experience',core.getFlag('v')[core.group]*core.getFlag('v')[core.group]*5);core.updateStatusBar();\n}"}],"new":[{type:"function","function":"function(){\nvar t=[[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0]];for(var i=1;i<=10;i++)for(var j=1;j<=10;j++)t[i][j]=core.rand(5)+1;core.setFlag('mp',t)\n}"}],main:[{type:"insert",name:"new"},{type:"insert",name:"draw"},{type:"setValue",name:"flag:__",value:"0",norefresh:true},{type:"while",condition:"core.fs()",data:[{type:"wait"},{type:"if",condition:"flag:x==12&&flag:y==0","true":[{type:"setValue",name:"flag:GEL",value:"1",norefresh:true}]},{type:"if",condition:"flag:x<10&&flag:y>2","true":[{type:"setValue",name:"flag:x",value:"flag:x+1",norefresh:true},{type:"setValue",name:"flag:y",value:"13-flag:y",norefresh:true},{type:"if",condition:"core.group==flag:grp[flag:x][flag:y]&&core.group>0","true":[{type:"playSound",name:"broken.mp3"},{type:"addValue",name:"status:hp",value:"status:experience",norefresh:true},{type:"if",condition:"status:hp>=status:mdef&&flag:__==0","true":[{type:"setValue",name:"flag:__",value:"1",norefresh:true},{type:"playSound",name:"stageclear.mp3"}]},{type:"function","function":"function(){\nfor(var i=1;i<=10;i++)for(var j=1;j<=10;j++)if(core.getFlag('grp')[i][j]==core.group)core.status.hero.flags.mp[i][j]=0;core.group=0;\n}"},{type:"insert",name:"draw"},{type:"sleep",time:100},{type:"function","function":"function(){\ncore.drop()\n}"},{type:"insert",name:"draw"},{type:"sleep",time:100},{type:"function","function":"function(){\ncore.left()\n}"},{type:"insert",name:"draw"},{type:"autoSave",nohint:true}],"false":[{type:"setValue",name:"flag:_",value:"flag:grp[flag:x][flag:y]",norefresh:true},{type:"if",condition:"flag:_>0","true":[{type:"playSound",name:"select.mp3"}]},{type:"function","function":"function(){\ncore.group=core.getFlag('_')\n}"},{type:"insert",name:"draw"}]}]}]},{type:"function","function":'function(){\nvar cnt=0,bo=0;for(var i=1;i<=10;i++)for(var j=1;j<=10;j++)if(core.status.hero.flags.mp[i][j])cnt++;if(cnt<10)bo=2000-20*cnt*cnt;core.status.hero.hp+=bo;core.updateStatusBar();core.insertAction("剩余"+cnt+"个方块，奖励"+bo+"分");\n}'}],full:[{type:"function","function":"function(){\nfor(var i=1;i<=10;i++)for(var j=1;j<=10;j++)if(!core.status.hero.flags.mp[i][j])core.status.hero.flags.mp[i][j]=core.rand(5)+1;\n}"}]}};var plugins_bb40132b_638b_4a9f_b028_d3fe47acc8d1={init:function(){console.log("插件编写测试");this._afterLoadResources=function(){};this.sol=function(d,e,b,c){var a=core.getFlag("mp");core.status.hero.flags.grp[d][e]=b;c[b]++;if(a[d-1][e]==a[d][e]&&!core.status.hero.flags.grp[d-1][e]){core.sol(d-1,e,b,c)}if(a[d+1][e]==a[d][e]&&!core.status.hero.flags.grp[d+1][e]){core.sol(d+1,e,b,c)}if(a[d][e-1]==a[d][e]&&!core.status.hero.flags.grp[d][e-1]){core.sol(d,e-1,b,c)}if(a[d][e+1]==a[d][e]&&!core.status.hero.flags.grp[d][e+1]){core.sol(d,e+1,b,c)}};this.fs=function(){core.setFlag("grp",[[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0]]);core.setFlag("_",0);var c=core.getFlag("mp"),d=0,e=[0];for(var a=1;a<=10;a++){for(var b=1;b<=10;b++){if(c[a][b]&&!core.getFlag("grp")[a][b]&&!(c[a][b]!=c[a][b-1]&&c[a][b]!=c[a][b+1]&&c[a][b]!=c[a-1][b]&&c[a][b]!=c[a+1][b])){e.push(0),core.sol(a,b,++d,e)}}}core.setFlag("v",e);return d};this.drop=function(){var d=[0,0,0,0,0,0,0,0,0,0,0,0];for(var a=1;a<=10;a++){d=[0,0,0,0,0,0,0,0,0,0,0,0];for(var b=1,c=0;b<=10;b++){if(core.status.hero.flags.mp[a][b]){d[++c]=core.status.hero.flags.mp[a][b]}}core.status.hero.flags.mp[a]=d}};this.left=function(){var c=[[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0]];for(var a=1,b=0;a<=10;a++){if(core.status.hero.flags.mp[a][1]){c[++b]=core.status.hero.flags.mp[a]}}core.setFlag("mp",c)}},drawLight:function(){this.drawLight=function(e,a,d,c){var b=core.getContextByName(e);if(b==null){if(typeof e=="string"){b=core.createCanvas(e,0,0,core.__PIXELS__,core.__PIXELS__,98)}else{return}}b.mozImageSmoothingEnabled=false;b.webkitImageSmoothingEnabled=false;b.msImageSmoothingEnabled=false;b.imageSmoothingEnabled=false;core.clearMap(e);if(a==null){a=0.9}b.fillStyle="rgba(0,0,0,"+a+")";b.fillRect(0,0,b.canvas.width,b.canvas.height);c=core.clamp(c,0,1);b.globalCompositeOperation="destination-out";d.forEach(function(h){var j=h[0],k=h[1],i=h[2];var f=parseInt(i*c);var g=b.createRadialGradient(j,k,f,j,k,i);g.addColorStop(0,"rgba(0,0,0,1)");g.addColorStop(1,"rgba(0,0,0,0)");b.beginPath();b.fillStyle=g;b.arc(j,k,i,0,2*Math.PI);b.fill()});b.globalCompositeOperation="source-over"}},itemShop:function(){var i=null;var l=0;var h=0;var g=0;var f=0;var k=0;var j=0;var d=[];var c=core.ui._buildFont(20,false),e=core.ui._buildFont(18,false);this.drawItemShop=function(){core.ui._createUIEvent();core.clearMap("uievent");core.ui._uievent_drawSelector({code:1});core.ui._uievent_drawSelector({code:2});core.setTextAlign("uievent","left");core.setTextBaseline("uievent","top");core.fillRect("uievent",0,0,416,416,"black");core.ui._uievent_drawBackground({background:"winskin.png",x:0,y:0,width:416,height:56});core.ui._uievent_drawBackground({background:"winskin.png",x:0,y:56,width:312,height:56});core.ui._uievent_drawBackground({background:"winskin.png",x:0,y:112,width:312,height:304});core.ui._uievent_drawBackground({background:"winskin.png",x:312,y:56,width:104,height:56});core.ui._uievent_drawBackground({background:"winskin.png",x:312,y:112,width:104,height:304});core.setFillStyle("uievent","white");core.setStrokeStyle("uievent","white");core.fillText("uievent","购买",32,74,"white",c);core.fillText("uievent","卖出",132,74);core.fillText("uievent","离开",232,74);core.fillText("uievent","当前金币",324,66,null,e);core.setTextAlign("uievent","right");core.fillText("uievent",core.formatBigNumber(core.status.hero.money),405,89);core.setTextAlign("uievent","left");core.ui._uievent_drawSelector({type:"drawSelector",image:"winskin.png",code:2,x:22+100*l,y:66,width:60,height:33});if(h!=null){core.setTextAlign("uievent","center");core.fillText("uievent",l==0?"买入个数":"卖出个数",364,320,null,c);core.fillText("uievent","?   "+g+"   ?",364,350);core.fillText("uievent","确定",364,380)}var m=core.status.shops[i].choices;d=m.filter(function(z){if(z.condition!=null){try{if(!core.calValue(z.condition)){return false}}catch(y){}}return(l==0&&z.money!=null)||(l==1&&z.sell!=null)});var v=6;k=Math.ceil(d.length/v);f=Math.floor((h||0)/v)+1;if(k>1){var r=156;core.setTextAlign("uievent","center");core.fillText("uievent",f+" / "+k,r,388,null,e);if(f>1){core.fillText("uievent","上一页",r-80,388)}if(f<k){core.fillText("uievent","下一页",r+80,388)}}core.setTextAlign("uievent","left");var w=(f-1)*v;for(var t=0;t<v;++t){var o=w+t;if(o>=d.length){break}var u=d[o];core.drawIcon("uievent",u.id,10,125+t*40);core.setTextAlign("uievent","left");core.fillText("uievent",core.material.items[u.id].name,50,132+t*40,null,c);core.setTextAlign("uievent","right");core.fillText("uievent",(l==0?core.calValue(u.money):core.calValue(u.sell))+"金币/个",300,133+t*40,null,e);core.setTextAlign("uievent","left");if(o==h){var x=core.material.items[u.id].text||"该道具暂无描述";try{x=core.replaceText(x)}catch(p){}for(var q=20;q>=8;q-=2){var n={left:10,fontSize:q,maxWidth:403,lineHeight:1.4};var s=core.getTextContentHeight(x,n);if(s<=50){n.top=(56-s)/2;core.drawTextContent("uievent",x,n);break}}core.ui._uievent_drawSelector({type:"drawSelector",image:"winskin.png",code:1,x:8,y:120+t*40,width:295,height:40});if(l==0&&u.number!=null){core.fillText("uievent","存货",324,132,null,c);core.setTextAlign("uievent","right");core.fillText("uievent",u.number,406,132,null,null,40)}else{if(l==1){core.fillText("uievent","数量",324,132,null,c);core.setTextAlign("uievent","right");core.fillText("uievent",core.itemCount(u.id),406,132,null,null,40)}}core.setTextAlign("uievent","left");core.fillText("uievent","预计金额",324,250);core.setTextAlign("uievent","right");j=g*(l==0?core.calValue(u.money):core.calValue(u.sell));core.fillText("uievent",core.formatBigNumber(j),405,280);core.setTextAlign("uievent","left");core.fillText("uievent",l==0?"已购次数":"已卖次数",324,170);core.setTextAlign("uievent","right");core.fillText("uievent",(l==0?u.money_count:u.sell_count)||0,405,200)}}core.setTextAlign("uievent","left");core.setTextBaseline("uievent","alphabetic")};var a=function(n,m){if(n==null){return}g=core.clamp(g+m,0,Math.min(l==0?Math.floor(core.status.hero.money/core.calValue(n.money)):core.itemCount(n.id),l==0&&n.number!=null?n.number:Number.MAX_SAFE_INTEGER))};var b=function(m){if(m==null||g==0){return}if(l==0){core.status.hero.money-=j;core.getItem(m.id,g);if(m.number!=null){m.number-=g}m.money_count=(m.money_count||0)+g}else{core.status.hero.money+=j;core.removeItem(m.id,g);core.drawTip("成功卖出"+g+"个"+core.material.items[m.id].name,m.id);if(m.number!=null){m.number+=g}m.sell_count=(m.sell_count||0)+g}g=0};this._performItemShopKeyBoard=function(n){var m=d[h]||null;switch(n){case 38:if(h==null){break}if(h==0){h=null}else{h--}g=0;break;case 37:if(h==null){if(l>0){l--}break}a(m,-1);break;case 39:if(h==null){if(l<2){l++}break}a(m,1);break;case 40:if(h==null){if(d.length>0){h=0}break}if(d.length==0){break}h=Math.min(h+1,d.length-1);g=0;break;case 13:case 32:if(h==null){if(l==2){core.insertAction({type:"break"})}else{if(d.length>0){h=0}}break}b(m);break;case 27:if(h==null){core.insertAction({type:"break"});break}h=null;break}};this._performItemShopClick=function(p,q){var n=d[h]||null;if(p>=22&&p<=82&&q>=71&&q<=102){if(l!=0){l=0;h=null;g=0}return}if(p>=122&&p<=182&&q>=71&&q<=102){if(l!=1){l=1;h=null;g=0}return}if(p>=222&&p<=282&&q>=71&&q<=102){return core.insertAction({type:"break"})}if(p>=318&&p<=341&&q>=348&&q<=376){return a(n,-1)}if(p>=388&&p<=416&&q>=348&&q<=376){return a(n,1)}if(p>=341&&p<=387&&q>=380&&q<=407){return b(n)}if(p>=45&&p<=105&&q>=388){if(f>1){h-=6}return}if(p>=208&&p<=268&&q>=388){if(f<k){h=Math.min(h+6,d.length-1)}return}if(p>=9&&p<=300&&q>=120&&q<360){if(d.length==0){return}var m=parseInt((q-120)/40);var o=6*(f-1)+m;if(o>=d.length){o=d.length-1}if(o!=h){h=o;g=0}return}};this.performItemShopAction=function(){if(flags.type==0){return this._performItemShopKeyBoard(flags.keycode)}else{return this._performItemShopClick(flags.px,flags.py)}};this.openItemShop=function(m){i=m;l=0;f=0;h=null;g=0;core.insertAction([{type:"while",condition:"true",data:[{type:"function","function":"function () { core.drawItemShop(); }"},{type:"wait"},{type:"function","function":"function() { core.performItemShopAction(); }"}]},{type:"function","function":'function () { core.deleteCanvas(\'uievent\'); core.ui._uievent_drawSelector({ "code": 1 }); core.ui._uievent_drawSelector({ "code": 2 }); }'}])};core.control.saveData=function(){var m=this.controldata.saveData();for(var n in core.status.shops){if(core.status.shops[n].item){m.shops[n].choices=core.status.shops[n].choices.map(function(o){return{number:o.number,money_count:o.money_count||0,sell_count:o.sell_count||0}})}}return m};core.control.loadData=function(n,m){this.controldata.loadData(n,m);for(var p in n.shops){if(n.shops[p].choices){for(var o=0;o<n.shops[p].choices.length;++o){core.status.shops[p].choices[o].number=n.shops[p].choices[o].number;core.status.shops[p].choices[o].money_count=n.shops[p].choices[o].money_count;core.status.shops[p].choices[o].sell_count=n.shops[p].choices[o].sell_count}}}}},smoothCamera:function(){this.__enableSmoothCamera=false;if(!this.__enableSmoothCamera){return}this.Camera=function(){this.__switchName="smoothCamera";this._cameraNeedRefresh=true;this._nowOffsetX=0;this._nowOffsetY=0;this._targetOffsetX=0;this._targetOffsetY=0;this._currentFloorId=null;this.resetCamera=function(){this._targetOffsetX=core.bigmap.offsetX;this._targetOffsetY=core.bigmap.offsetY;this._nowOffsetX=this._targetOffsetX;this._nowOffsetY=this._targetOffsetY;this._cameraNeedRefresh=true};this.setTarget=function(a,b){this._targetOffsetX=a;this._targetOffsetY=b};this.requestCameraUpdate=function(){this._cameraNeedRefresh=true};this.updateTargetPosition=function(){this._targetOffsetX=core.bigmap.offsetX;this._targetOffsetY=core.bigmap.offsetY};this.updateRefreshFlag=function(){if(this._nowOffsetX!=this._targetOffsetX||this._nowOffsetY!=this._targetOffsetY){this._cameraNeedRefresh=true}};this.canDirectMove=function(){return !core.getFlag(this.__switchName,true)};this.updateCameraPosition=function(){if(this._cameraNeedRefresh){this._cameraNeedRefresh=false;var a=this._targetOffsetX-this._nowOffsetX;var b=this._targetOffsetY-this._nowOffsetY;if(Math.abs(a)<=2&&Math.abs(b)<=2||this.canDirectMove()){this._nowOffsetX=this._targetOffsetX;this._nowOffsetY=this._targetOffsetY}else{this._nowOffsetX+=a/10;this._nowOffsetY+=b/10}var c=-Math.floor(this._nowOffsetX);var d=-Math.floor(this._nowOffsetY);core.bigmap.canvas.forEach(function(e){core.control.setGameCanvasTranslate(e,c,d)});core.relocateCanvas("route",core.status.automaticRoute.offsetX+c,core.status.automaticRoute.offsetY+d);core.setGameCanvasTranslate("hero",c+this._targetOffsetX,d+this._targetOffsetY)}};this.update=function(){this.updateTargetPosition();this.updateRefreshFlag();this.updateCameraPosition()}};control.drawHero=function(g,d){if(!core.isPlaying()||!core.status.floorId||core.status.gameOver){return}var i=core.getHeroLoc("x"),j=core.getHeroLoc("y"),a=core.getHeroLoc("direction");g=g||"stop";d=d||0;var h=core.utils.scan[a];var b=h.x,c=h.y,e=b*d,f=c*d;core.bigmap.offsetX=core.clamp((i-core.__HALF_SIZE__)*32+e,0,32*core.bigmap.width-core.__PIXELS__);core.bigmap.offsetY=core.clamp((j-core.__HALF_SIZE__)*32+f,0,32*core.bigmap.height-core.__PIXELS__);core.clearAutomaticRouteNode(i+b,j+c);core.clearMap("hero");if(!core.hasFlag("hideHero")){this._drawHero_getDrawObjs(a,i,j,g,d).forEach(function(k){core.drawImage("hero",k.img,k.heroIcon[k.status]*k.width,k.heroIcon.loc*k.height,k.width,k.height,k.posx+(32-k.width)/2,k.posy+32-k.height,k.width,k.height)})}core.control.updateViewport()};core.drawHero=function(b,a){return core.control.drawHero(b,a)};this.camera=new this.Camera();this.updateCameraEx=function(){this.camera.update()};control.updateViewport=function(){core.plugin.camera.requestCameraUpdate()};events.prototype.changingFloor=function(a,c,b){this.eventdata.changingFloor(a,c,b);core.plugin.camera.resetCamera()};core.registerAnimationFrame("smoothCameraFlash",true,this.updateCameraEx.bind(this))},rewrite:function(){core.statusBar.image.save.onclick=function(){if(core.status.event.id=="save"){core.events.recoverEvents(core.status.event.interval)}else{return;if(core.status.event.data.current.type!="wait"){return}core.insertAction([{type:"callSave"},{type:"wait"}]);core.doAction()}};core.statusBar.image.load.onclick=function(){if(core.status.event.id=="load"){core.events.recoverEvents(core.status.event.interval)}else{if(core.status.event.data.current.type!="wait"){return}core.insertAction([{type:"callLoad"},{type:"wait"}]);core.doAction()}};core.statusBar.image.settings.onclick=function(){if(core.status.event.data.current.type!="wait"){return}core.insertAction([{type:"confirm",text:"返回标题界面？",yes:[{type:"restart"}],no:[]},{type:"wait"}]);core.doAction()}}};